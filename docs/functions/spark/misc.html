<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Miscellaneous Functions &#8212; Velox  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/nature.css?v=0f882399" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Regular Expression Functions" href="regexp.html" />
    <link rel="prev" title="Map Functions" href="map.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="regexp.html" title="Regular Expression Functions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="map.html" title="Map Functions"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Velox  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../spark_functions.html" accesskey="U">Spark Functions</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Miscellaneous Functions</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="miscellaneous-functions">
<h1>Miscellaneous Functions<a class="headerlink" href="#miscellaneous-functions" title="Link to this heading">¶</a></h1>
<dl class="spark function">
<dt class="sig sig-object spark" id="at_least_n_non_nulls">
<span class="sig-name descname"><span class="pre">at_least_n_non_nulls</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">...</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">valueN</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#at_least_n_non_nulls" title="Link to this definition">¶</a></dt>
<dd><p>Returns true if there are at least <code class="docutils literal notranslate"><span class="pre">n</span></code> non-null and non-NaN values,
or false otherwise. <code class="docutils literal notranslate"><span class="pre">value1,</span> <span class="pre">value2,</span> <span class="pre">...,</span> <span class="pre">valueN</span></code> are evaluated lazily.
If <code class="docutils literal notranslate"><span class="pre">n</span></code> non-null and non-NaN values are found, the function will stop
evaluating the remaining arguments. If <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">&lt;=</span> <span class="pre">0</span></code>, the result is true. null
<code class="docutils literal notranslate"><span class="pre">n</span></code> is not allowed.
Nested nulls in complex type values are handled as non-nulls.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">at_least_n_non_nulls</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NAN</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>  <span class="o">--</span> <span class="n">false</span>
<span class="n">SELECT</span> <span class="n">at_least_n_non_nulls</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>  <span class="o">--</span> <span class="n">true</span>
<span class="n">SELECT</span> <span class="n">at_least_n_non_nulls</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">array</span><span class="p">(</span><span class="n">NULL</span><span class="p">),</span> <span class="n">NULL</span><span class="p">);</span>  <span class="o">--</span> <span class="n">true</span>
</pre></div>
</div>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="get_array_struct_fields">
<span class="sig-name descname"><span class="pre">get_array_struct_fields</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ordinal</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#get_array_struct_fields" title="Link to this definition">¶</a></dt>
<dd><p>Extracts the <code class="docutils literal notranslate"><span class="pre">ordinal</span></code>-th fields of all array elements, and returns them as a new array.
The first input must be of array(strcut) type and nested complex type is allowed.
The <code class="docutils literal notranslate"><span class="pre">ordinal</span></code> is 0-based, and if <code class="docutils literal notranslate"><span class="pre">ordinal</span></code> is negative or no less than
the children size of strcut, exception is thrown.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">items</span><span class="o">.</span><span class="n">col1</span> <span class="n">FROM</span> <span class="n">VALUES</span> <span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="n">struct</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;foo&#39;</span><span class="p">),</span> <span class="n">struct</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="s1">&#39;bar&#39;</span><span class="p">)))</span> <span class="n">AS</span> <span class="n">t</span><span class="p">(</span><span class="n">items</span><span class="p">);</span> <span class="o">--</span> <span class="n">array</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">SELECT</span> <span class="n">items</span><span class="o">.</span><span class="n">col2</span> <span class="n">FROM</span> <span class="n">VALUES</span> <span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="n">struct</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;foo&#39;</span><span class="p">),</span> <span class="n">struct</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="s1">&#39;bar&#39;</span><span class="p">)))</span> <span class="n">AS</span> <span class="n">t</span><span class="p">(</span><span class="n">items</span><span class="p">);</span> <span class="o">--</span> <span class="n">array</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="get_struct_field">
<span class="sig-name descname"><span class="pre">get_struct_field</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">struct</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ordinal</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">T</span></span></span><a class="headerlink" href="#get_struct_field" title="Link to this definition">¶</a></dt>
<dd><p>Returns the value of nested subfield at position <code class="docutils literal notranslate"><span class="pre">ordinal</span></code> in the input <code class="docutils literal notranslate"><span class="pre">struct</span></code>.
The input must be of row type and nested complex type is allowed.
The <code class="docutils literal notranslate"><span class="pre">ordinal</span></code> is 0-based, and if <code class="docutils literal notranslate"><span class="pre">ordinal</span></code> is negative or greater than or equal to
the children size of <code class="docutils literal notranslate"><span class="pre">struct</span></code>, exception is thrown.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">from_json</span><span class="p">(</span><span class="s1">&#39;{&quot;a&quot;: 1, &quot;b&quot;: [1, 2, 3]}&#39;</span><span class="p">,</span> <span class="s1">&#39;a INT, b ARRAY&lt;INT&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">a</span><span class="p">;</span> <span class="o">--</span> <span class="mi">1</span>
<span class="n">SELECT</span> <span class="n">from_json</span><span class="p">(</span><span class="s1">&#39;{&quot;a&quot;: 1, &quot;b&quot;: [1, 2, 3]}&#39;</span><span class="p">,</span> <span class="s1">&#39;a INT, b ARRAY&lt;INT&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">b</span><span class="p">;</span> <span class="o">--</span> <span class="n">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="monotonically_increasing_id">
<span class="sig-name descname"><span class="pre">monotonically_increasing_id</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bigint</span></span></span><a class="headerlink" href="#monotonically_increasing_id" title="Link to this definition">¶</a></dt>
<dd><p>Returns monotonically increasing 64-bit integers. The generated ID is
guaranteed to be monotonically increasing and unique, but not consecutive.
The current implementation puts the partition ID in the upper 31 bits, and
the lower 33 bits represent the record number within each partition.
The assumption is that the data frame has less than 1 billion partitions,
and each partition has less than 8 billion records.
The function relies on partition IDs, which are provided by the framework
via the configuration ‘spark.partition_id’.</p>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="raise_error">
<span class="sig-name descname"><span class="pre">raise_error</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#raise_error" title="Link to this definition">¶</a></dt>
<dd><p>Throws a user error with the specified <code class="docutils literal notranslate"><span class="pre">message</span></code>.
If <code class="docutils literal notranslate"><span class="pre">message</span></code> is NULL, throws a user error with empty message.</p>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="spark_partition_id">
<span class="sig-name descname"><span class="pre">spark_partition_id</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">integer</span></span></span><a class="headerlink" href="#spark_partition_id" title="Link to this definition">¶</a></dt>
<dd><p>Returns the current partition id.
The framework provides partition id through the configuration
‘spark.partition_id’.
It ensures deterministic data partitioning and assigns a unique partition
id to each task in a deterministic way. Consequently, this function is
marked as deterministic, enabling Velox to perform constant folding on it.</p>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="uuid">
<span class="sig-name descname"><span class="pre">uuid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">seed</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">string</span></span></span><a class="headerlink" href="#uuid" title="Link to this definition">¶</a></dt>
<dd><p>Returns an universally unique identifier (UUID) string. The value is
returned as a canonical UUID 36-character string. The UUID is generated
from Pseudo-Random Numbers with the seed by combining user-specified
<code class="docutils literal notranslate"><span class="pre">seed</span></code> and the configuration <cite>spark.partition_id</cite>.
<code class="docutils literal notranslate"><span class="pre">seed</span></code> must be constant.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">uuid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>    <span class="o">--</span> <span class="s2">&quot;8c7f0aac-97c4-4a2f-b716-a675d821ccc0&quot;</span>
</pre></div>
</div>
</dd></dl>

</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Miscellaneous Functions</a><ul>
<li><a class="reference internal" href="#at_least_n_non_nulls"><code class="docutils literal notranslate"><span class="pre">at_least_n_non_nulls()</span></code></a></li>
<li><a class="reference internal" href="#get_array_struct_fields"><code class="docutils literal notranslate"><span class="pre">get_array_struct_fields()</span></code></a></li>
<li><a class="reference internal" href="#get_struct_field"><code class="docutils literal notranslate"><span class="pre">get_struct_field()</span></code></a></li>
<li><a class="reference internal" href="#monotonically_increasing_id"><code class="docutils literal notranslate"><span class="pre">monotonically_increasing_id()</span></code></a></li>
<li><a class="reference internal" href="#raise_error"><code class="docutils literal notranslate"><span class="pre">raise_error()</span></code></a></li>
<li><a class="reference internal" href="#spark_partition_id"><code class="docutils literal notranslate"><span class="pre">spark_partition_id()</span></code></a></li>
<li><a class="reference internal" href="#uuid"><code class="docutils literal notranslate"><span class="pre">uuid()</span></code></a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="map.html"
                          title="previous chapter">Map Functions</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="regexp.html"
                          title="next chapter">Regular Expression Functions</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/functions/spark/misc.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="regexp.html" title="Regular Expression Functions"
             >next</a> |</li>
        <li class="right" >
          <a href="map.html" title="Map Functions"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Velox  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../spark_functions.html" >Spark Functions</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Miscellaneous Functions</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright TBD.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    </div>
  </body>
</html>