<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Decimal Operators &#8212; Velox  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/nature.css?v=0f882399" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Comparison Functions" href="comparison.html" />
    <link rel="prev" title="Bitwise Functions" href="bitwise.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="comparison.html" title="Comparison Functions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="bitwise.html" title="Bitwise Functions"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Velox  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../spark_functions.html" accesskey="U">Spark Functions</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Decimal Operators</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="decimal-operators">
<h1>Decimal Operators<a class="headerlink" href="#decimal-operators" title="Link to this heading">¶</a></h1>
<p>The result precision and scale computation of arithmetic operators contains two stages.
First stage computes precision and scale using formulas based on the SQL standard and Hive when allow-precision-loss is true.
The result may exceed maximum allowed precision of 38.</p>
<p>Second stage caps precision at 38 and either reduces the scale or not depending on allow-precision-loss flag.</p>
<p>For example, addition of decimal(38, 7) and decimal(10, 0) requires precision of 39 and scale of 7.
Since precision exceeds 38 it needs to be capped. When allow-precision-loss, precision is capped at 38 and scale is reduced by 1 to 6.
When allow-precision-loss is false, precision is capped at 38 as well, but scale is kept at 7.
With allow-precision-loss all additions will succeed, but accuracy (number of digits after period) of some operations will be reduced.
Without allow-precision-loss, some additions will return NULL.</p>
<p>For example,</p>
<p>The following queries keep accuracy or return NULL when allow-precision-loss is false:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">cast</span><span class="p">(</span><span class="s1">&#39;1.1232154&#39;</span> <span class="k">as</span> <span class="n">decimal</span><span class="p">(</span><span class="mi">38</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span> <span class="o">+</span> <span class="n">cast</span><span class="p">(</span><span class="s1">&#39;1&#39;</span> <span class="k">as</span> <span class="n">decimal</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span> <span class="o">--</span> <span class="mf">2.123215</span>
<span class="n">select</span> <span class="n">cast</span><span class="p">(</span><span class="s1">&#39;9999999999999999999999999999999.2345678&#39;</span> <span class="k">as</span> <span class="n">decimal</span><span class="p">(</span><span class="mi">38</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span> <span class="o">+</span> <span class="n">cast</span><span class="p">(</span><span class="s1">&#39;1&#39;</span> <span class="k">as</span> <span class="n">decimal</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span> <span class="o">--</span> <span class="n">NULL</span>
</pre></div>
</div>
<p>These same operations succeed when allow-precision-loss is true:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">cast</span><span class="p">(</span><span class="s1">&#39;1.1232154&#39;</span> <span class="k">as</span> <span class="n">decimal</span><span class="p">(</span><span class="mi">38</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span> <span class="o">+</span> <span class="n">cast</span><span class="p">(</span><span class="s1">&#39;1&#39;</span> <span class="k">as</span> <span class="n">decimal</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span> <span class="o">--</span> <span class="mf">2.12321</span><span class="p">,</span> <span class="n">lost</span> <span class="n">the</span> <span class="n">last</span> <span class="n">digit</span>
<span class="n">select</span> <span class="n">cast</span><span class="p">(</span><span class="s1">&#39;9999999999999999999999999999999.2345678&#39;</span> <span class="k">as</span> <span class="n">decimal</span><span class="p">(</span><span class="mi">38</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span> <span class="o">+</span> <span class="n">cast</span><span class="p">(</span><span class="s1">&#39;1&#39;</span> <span class="k">as</span> <span class="n">decimal</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span> <span class="o">--</span> <span class="mf">10000000000000000000000000000000.234568</span>
</pre></div>
</div>
<section id="decimal-precision-and-scale-computation-formulas">
<h2>Decimal Precision and Scale Computation Formulas<a class="headerlink" href="#decimal-precision-and-scale-computation-formulas" title="Link to this heading">¶</a></h2>
<p>The HiveQL behavior:</p>
<p><a class="reference external" href="https://cwiki.apache.org/confluence/download/attachments/27362075/Hive_Decimal_Precision_Scale_Support.pdf">https://cwiki.apache.org/confluence/download/attachments/27362075/Hive_Decimal_Precision_Scale_Support.pdf</a></p>
<p>Additionally, the computation of decimal division adapts to the allow-precision-loss flag,
while the decimal addition, subtraction, multiplication and integer division do not.</p>
<section id="addition-and-subtraction">
<h3>Addition and Subtraction<a class="headerlink" href="#addition-and-subtraction" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">p1</span> <span class="o">-</span> <span class="n">s1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">s2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">s</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="multiplication">
<h3>Multiplication<a class="headerlink" href="#multiplication" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">+</span> <span class="n">p2</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">+</span> <span class="n">s2</span>
</pre></div>
</div>
</section>
<section id="division">
<h3>Division<a class="headerlink" href="#division" title="Link to this heading">¶</a></h3>
<p>When allow-precision-loss is true:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">s1</span> <span class="o">+</span> <span class="n">s2</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">s1</span> <span class="o">+</span> <span class="n">p2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">s1</span> <span class="o">+</span> <span class="n">p2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>When allow-precision-loss is false:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wholeDigits</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">38</span><span class="p">,</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">s1</span> <span class="o">+</span> <span class="n">s2</span><span class="p">);</span>
<span class="n">fractionalDigits</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">38</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">s1</span> <span class="o">+</span> <span class="n">p2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">wholeDigits</span> <span class="o">+</span> <span class="n">fractionalDigits</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">fractionalDigits</span>
</pre></div>
</div>
</section>
<section id="integer-division">
<h3>Integer Division<a class="headerlink" href="#integer-division" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>precision = p1 - s1 + s2
p = precision == 0 ? 1 : min(38,  precision)
s = 0
</pre></div>
</div>
</section>
</section>
<section id="decimal-precision-and-scale-adjustment">
<h2>Decimal Precision and Scale Adjustment<a class="headerlink" href="#decimal-precision-and-scale-adjustment" title="Link to this heading">¶</a></h2>
<p>When allow-precision-loss is true, rounds the decimal part of the result if an exact representation is not possible.
Otherwise, returns NULL.
Notice: some operations succeed if precision loss is allowed and return NULL if not.</p>
<p>For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">cast</span><span class="p">(</span><span class="mf">0.1234567891011</span> <span class="k">as</span> <span class="n">decimal</span><span class="p">(</span><span class="mi">38</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span> <span class="o">*</span> <span class="n">cast</span><span class="p">(</span><span class="mf">1234.1</span> <span class="k">as</span> <span class="n">decimal</span><span class="p">(</span><span class="mi">38</span><span class="p">,</span> <span class="mi">18</span><span class="p">));</span>
<span class="o">--</span> <span class="mf">152.358023</span> <span class="k">if</span> <span class="n">allow</span><span class="o">-</span><span class="n">precision</span><span class="o">-</span><span class="n">loss</span><span class="p">,</span> <span class="n">NULL</span> <span class="n">otherwise</span><span class="o">.</span>
</pre></div>
</div>
<p>Below formula illustrates how the result precision and scale are adjusted.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">precision</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">scale</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">38</span> <span class="o">-</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">s</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
<p>When precision loss is not allowed, caps p at 38, and keeps scale as is.
The below formula shows how the precision and scale are adjusted for decimal addition, subtraction, and multiplication.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">precision</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">scale</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">38</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
<p>Decimal division uses a different formula:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">precision</span> <span class="o">=</span> <span class="mi">38</span>
<span class="n">scale</span> <span class="o">=</span> <span class="n">fractionalDigits</span> <span class="o">-</span> <span class="p">(</span><span class="n">wholeDigits</span> <span class="o">+</span> <span class="n">fractionalDigits</span> <span class="o">-</span> <span class="mi">38</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Returns NULL when the actual result cannot be represented with the calculated decimal type.</p>
</section>
<section id="arithmetic-functions">
<h2>Arithmetic Functions<a class="headerlink" href="#arithmetic-functions" title="Link to this heading">¶</a></h2>
<dl class="spark function">
<dt class="sig sig-object spark" id="div">
<span class="sig-name descname"><span class="pre">div</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">decimal(p1,</span> <span class="pre">s1)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">decimal(p2,</span> <span class="pre">s2)</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bigint</span></span></span><a class="headerlink" href="#div" title="Link to this definition">¶</a></dt>
<dd><p>Performs integer division and returns the bigint result of dividing <code class="docutils literal notranslate"><span class="pre">x</span></code> by <code class="docutils literal notranslate"><span class="pre">y</span></code>, truncating toward zero.
Truncation occurs if the result is within the result precision but exceeds the BIGINT range.
Division by zero or overflow results in NULL. Does not respect the <code class="docutils literal notranslate"><span class="pre">allow-precision-loss</span></code> configuration.
Corresponds to Spark’s operator <code class="docutils literal notranslate"><span class="pre">div</span></code> with <code class="docutils literal notranslate"><span class="pre">spark.sql.ansi.enabled</span></code> set to false.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">CAST</span><span class="p">(</span><span class="mi">1</span> <span class="k">as</span> <span class="n">DECIMAL</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="n">div</span> <span class="n">CAST</span><span class="p">(</span><span class="mi">2</span> <span class="k">as</span> <span class="n">DECIMAL</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span> <span class="o">--</span> <span class="mi">0</span>
<span class="n">SELECT</span> <span class="n">CAST</span><span class="p">(</span><span class="mi">21</span> <span class="k">as</span> <span class="n">DECIMAL</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="n">div</span> <span class="n">CAST</span><span class="p">(</span><span class="mi">20</span> <span class="k">as</span> <span class="n">DECIMAL</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span> <span class="o">--</span> <span class="mi">1</span>
<span class="n">SELECT</span> <span class="n">CAST</span><span class="p">(</span><span class="mi">1</span> <span class="k">as</span> <span class="n">DECIMAL</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="n">div</span> <span class="n">CAST</span><span class="p">(</span><span class="mi">0</span> <span class="k">as</span> <span class="n">DECIMAL</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span> <span class="o">--</span> <span class="n">NULL</span>
<span class="n">SELECT</span> <span class="n">CAST</span><span class="p">(</span><span class="mi">99999999999999999999999999999999999</span> <span class="k">as</span> <span class="n">DECIMAL</span><span class="p">(</span><span class="mi">38</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="n">div</span> <span class="n">CAST</span><span class="p">(</span><span class="mf">0.001</span> <span class="k">as</span> <span class="n">DECIMAL</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">));</span> <span class="o">--</span> <span class="mi">687399551400672280</span> <span class="o">//</span> <span class="n">Result</span> <span class="ow">is</span> <span class="n">truncated</span> <span class="n">to</span> <span class="n">int64_t</span><span class="o">.</span>
</pre></div>
</div>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="checked_div">
<span class="sig-name descname"><span class="pre">checked_div</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">decimal(p1,</span> <span class="pre">s1)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">decimal(p2,</span> <span class="pre">s2)</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bigint</span></span></span><a class="headerlink" href="#checked_div" title="Link to this definition">¶</a></dt>
<dd><p>Performs integer division and returns the bigint result of dividing <code class="docutils literal notranslate"><span class="pre">x</span></code> by <code class="docutils literal notranslate"><span class="pre">y</span></code>, truncating toward zero.
Truncation occurs if the result is within the result precision but exceeds the BIGINT range.
Division by zero or overflow results in an error.
Corresponds to Spark’s operator <code class="docutils literal notranslate"><span class="pre">div</span></code> with <code class="docutils literal notranslate"><span class="pre">spark.sql.ansi.enabled</span></code> set to true.</p>
</dd></dl>

</section>
<section id="decimal-functions">
<h2>Decimal Functions<a class="headerlink" href="#decimal-functions" title="Link to this heading">¶</a></h2>
<dl class="spark function">
<dt class="sig sig-object spark" id="ceil">
<span class="sig-name descname"><span class="pre">ceil</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x:</span> <span class="pre">decimal(p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">s))</span> <span class="pre">-&gt;</span> <span class="pre">r:</span> <span class="pre">decimal(pr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ceil" title="Link to this definition">¶</a></dt>
<dd><p>Returns <code class="docutils literal notranslate"><span class="pre">x</span></code> rounded up to the type <code class="docutils literal notranslate"><span class="pre">decimal(min(38,</span> <span class="pre">p</span> <span class="pre">-</span> <span class="pre">s</span> <span class="pre">+</span> <span class="pre">min(1,</span> <span class="pre">s)),</span> <span class="pre">0)</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">ceil</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="mf">1.23</span> <span class="k">as</span> <span class="n">DECIMAL</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)));</span> <span class="o">--</span> <span class="mi">2</span> <span class="o">//</span> <span class="n">Output</span> <span class="nb">type</span><span class="p">:</span> <span class="n">decimal</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="decimal_equalto">
<span class="sig-name descname"><span class="pre">decimal_equalto</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">boolean</span></span></span><a class="headerlink" href="#decimal_equalto" title="Link to this definition">¶</a></dt>
<dd><p>Returns true if x is equal to y. Supports decimal types with different precisions and scales.
Corresponds to Spark’s operator <code class="docutils literal notranslate"><span class="pre">==</span></code>.</p>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="decimal_greaterthan">
<span class="sig-name descname"><span class="pre">decimal_greaterthan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">boolean</span></span></span><a class="headerlink" href="#decimal_greaterthan" title="Link to this definition">¶</a></dt>
<dd><p>Returns true if x is greater than y. Supports decimal types with different precisions and scales.
Corresponds to Spark’s operator <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>.</p>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="decimal_greaterthanorequal">
<span class="sig-name descname"><span class="pre">decimal_greaterthanorequal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">boolean</span></span></span><a class="headerlink" href="#decimal_greaterthanorequal" title="Link to this definition">¶</a></dt>
<dd><p>Returns true if x is greater than y or x is equal to y. Supports decimal types with different precisions and scales.
Corresponds to Spark’s operator <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>.</p>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="decimal_lessthan">
<span class="sig-name descname"><span class="pre">decimal_lessthan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">boolean</span></span></span><a class="headerlink" href="#decimal_lessthan" title="Link to this definition">¶</a></dt>
<dd><p>Returns true if x is less than y. Supports decimal types with different precisions and scales.
Corresponds to Spark’s operator <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>.</p>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="decimal_lessthanorequal">
<span class="sig-name descname"><span class="pre">decimal_lessthanorequal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">boolean</span></span></span><a class="headerlink" href="#decimal_lessthanorequal" title="Link to this definition">¶</a></dt>
<dd><p>Returns true if x is less than y or x is equal to y. Supports decimal types with different precisions and scales.
Corresponds to Spark’s operator <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>.</p>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="decimal_notequalto">
<span class="sig-name descname"><span class="pre">decimal_notequalto</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">boolean</span></span></span><a class="headerlink" href="#decimal_notequalto" title="Link to this definition">¶</a></dt>
<dd><p>Returns true if x is not equal to y. Supports decimal types with different precisions and scales.
Corresponds to Spark’s operator <code class="docutils literal notranslate"><span class="pre">!=</span></code>.</p>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="floor">
<span class="sig-name descname"><span class="pre">floor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x:</span> <span class="pre">decimal(p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">s))</span> <span class="pre">-&gt;</span> <span class="pre">r:</span> <span class="pre">decimal(pr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#floor" title="Link to this definition">¶</a></dt>
<dd><p>Returns <code class="docutils literal notranslate"><span class="pre">x</span></code> rounded down to the type <code class="docutils literal notranslate"><span class="pre">decimal(min(38,</span> <span class="pre">p</span> <span class="pre">-</span> <span class="pre">s</span> <span class="pre">+</span> <span class="pre">min(1,</span> <span class="pre">s)),</span> <span class="pre">0)</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">floor</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="mf">1.23</span> <span class="k">as</span> <span class="n">DECIMAL</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)));</span> <span class="o">--</span> <span class="mi">1</span> <span class="o">//</span> <span class="n">Output</span> <span class="nb">type</span><span class="p">:</span> <span class="n">decimal</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="in">
<span class="sig-name descname"><span class="pre">in</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x:</span> <span class="pre">decimal(p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">s)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">array(decimal(p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">s))</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">boolean</span></span></span><a class="headerlink" href="#in" title="Link to this definition">¶</a></dt>
<dd><p>Returns true if <code class="docutils literal notranslate"><span class="pre">x</span></code> matches at least one of the elements of the array.</p>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="unaryminus">
<span class="sig-name descname"><span class="pre">unaryminus</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x:</span> <span class="pre">decimal(p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">s))</span> <span class="pre">-&gt;</span> <span class="pre">r:</span> <span class="pre">decimal(p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">s</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#unaryminus" title="Link to this definition">¶</a></dt>
<dd><p>Returns negated value of x (r = -x). Corresponds to Spark’s operator <code class="docutils literal notranslate"><span class="pre">-</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">unaryminus</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="o">-</span><span class="mf">9999999999999999999.9999999999999999999</span> <span class="k">as</span> <span class="n">DECIMAL</span><span class="p">(</span><span class="mi">38</span><span class="p">,</span> <span class="mi">19</span><span class="p">)));</span> <span class="o">--</span> <span class="mf">9999999999999999999.9999999999999999999</span>
</pre></div>
</div>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="unscaled_value">
<span class="sig-name descname"><span class="pre">unscaled_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bigint</span></span></span><a class="headerlink" href="#unscaled_value" title="Link to this definition">¶</a></dt>
<dd><p>Return the unscaled bigint value of a short decimal <code class="docutils literal notranslate"><span class="pre">x</span></code>.
Supported type is: SHORT_DECIMAL.</p>
</dd></dl>

</section>
<section id="decimal-special-forms">
<h2>Decimal Special Forms<a class="headerlink" href="#decimal-special-forms" title="Link to this heading">¶</a></h2>
<dl class="spark function">
<dt class="sig sig-object spark" id="decimal_round">
<span class="sig-name descname"><span class="pre">decimal_round</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">decimal</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span></em><span class="optional">]</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="p"><span class="pre">[</span></span><span class="pre">decimal</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#decimal_round" title="Link to this definition">¶</a></dt>
<dd><p>Returns <code class="docutils literal notranslate"><span class="pre">decimal</span></code> rounded to a new scale using HALF_UP rounding mode. In HALF_UP rounding, the digit 5 is rounded up.
<code class="docutils literal notranslate"><span class="pre">scale</span></code> is the new scale to be rounded to. It is 0 by default, and integer in [INT_MIN, INT_MAX] is allowed to be its value.
When the absolute value of scale exceeds the maximum precision of long decimal (38), the round logic is equivalent to the case where it is 38 as we cannot exceed the maximum precision.
The result precision and scale are decided with the precision and scale of input <code class="docutils literal notranslate"><span class="pre">decimal</span></code> and <code class="docutils literal notranslate"><span class="pre">scale</span></code>.
After rounding we may need one more digit in the integral part.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">cast</span> <span class="p">(</span><span class="mf">9.9</span> <span class="k">as</span> <span class="n">decimal</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="mi">0</span><span class="p">));</span> <span class="o">--</span> <span class="n">decimal</span> <span class="mi">10</span>
<span class="n">SELECT</span> <span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">cast</span> <span class="p">(</span><span class="mi">99</span> <span class="k">as</span> <span class="n">decimal</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="o">--</span> <span class="n">decimal</span> <span class="mi">100</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">scale</span></code> is negative, we need to adjust <code class="docutils literal notranslate"><span class="pre">-scale</span></code> number of digits before the decimal point,
which means we need at least <code class="docutils literal notranslate"><span class="pre">-scale</span> <span class="pre">+</span> <span class="pre">1</span></code> digits after rounding, and the result scale is 0.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="nb">round</span><span class="p">(</span><span class="n">cast</span> <span class="p">(</span><span class="mf">0.856</span> <span class="k">as</span> <span class="n">DECIMAL</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="o">--</span> <span class="n">decimal</span> <span class="mi">0</span>
<span class="n">SELECT</span> <span class="nb">round</span><span class="p">(</span><span class="n">cast</span> <span class="p">(</span><span class="mf">85.6</span> <span class="k">as</span> <span class="n">DECIMAL</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="o">--</span> <span class="n">decimal</span> <span class="mi">90</span>
<span class="n">SELECT</span> <span class="nb">round</span><span class="p">(</span><span class="n">cast</span> <span class="p">(</span><span class="mf">85.6</span> <span class="k">as</span> <span class="n">DECIMAL</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="o">-</span><span class="mi">2</span><span class="p">);</span> <span class="o">--</span> <span class="n">decimal</span> <span class="mi">100</span>
<span class="n">SELECT</span> <span class="nb">round</span><span class="p">(</span><span class="n">cast</span> <span class="p">(</span><span class="mf">85.6</span> <span class="k">as</span> <span class="n">DECIMAL</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="o">-</span><span class="mi">99</span><span class="p">);</span>  <span class="o">--</span> <span class="n">decimal</span> <span class="mi">0</span>
<span class="n">SELECT</span> <span class="nb">round</span><span class="p">(</span><span class="n">cast</span> <span class="p">(</span><span class="mf">12345678901234.56789</span> <span class="k">as</span> <span class="n">DECIMAL</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span> <span class="o">-</span><span class="mi">9</span><span class="p">);</span> <span class="o">--</span> <span class="n">decimal</span> <span class="mi">12346000000000</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">scale</span></code> is 0, the result scale is 0.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="nb">round</span><span class="p">(</span><span class="n">cast</span> <span class="p">(</span><span class="mf">85.6</span> <span class="k">as</span> <span class="n">DECIMAL</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)));</span> <span class="o">--</span> <span class="n">decimal</span> <span class="mi">86</span>
<span class="n">SELECT</span> <span class="nb">round</span><span class="p">(</span><span class="n">cast</span> <span class="p">(</span><span class="mf">0.856</span> <span class="k">as</span> <span class="n">DECIMAL</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="mi">0</span><span class="p">);</span> <span class="o">--</span> <span class="n">decimal</span> <span class="mi">1</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">scale</span></code> is positive, the result scale is the minor one of input scale and <code class="docutils literal notranslate"><span class="pre">scale</span></code>.
The result precision is decided with the number of integral digits and the result scale, but cannot exceed the max precision of decimal.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="nb">round</span><span class="p">(</span><span class="n">cast</span> <span class="p">(</span><span class="mf">85.681</span> <span class="k">as</span> <span class="n">DECIMAL</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="mi">1</span><span class="p">);</span> <span class="o">--</span> <span class="n">decimal</span> <span class="mf">85.7</span>
<span class="n">SELECT</span> <span class="nb">round</span><span class="p">(</span><span class="n">cast</span> <span class="p">(</span><span class="mf">85.681</span> <span class="k">as</span> <span class="n">DECIMAL</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="mi">999</span><span class="p">);</span> <span class="o">--</span> <span class="n">decimal</span> <span class="mf">85.681</span>
<span class="n">SELECT</span> <span class="nb">round</span><span class="p">(</span><span class="n">cast</span> <span class="p">(</span><span class="mf">0.1234567890123456789</span> <span class="k">as</span> <span class="n">DECIMAL</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">19</span><span class="p">)),</span> <span class="mi">14</span><span class="p">);</span> <span class="o">--</span> <span class="n">decimal</span> <span class="mf">0.12345678901235</span>
</pre></div>
</div>
</dd></dl>

<dl class="spark function">
<dt class="sig sig-object spark" id="make_decimal">
<span class="sig-name descname"><span class="pre">make_decimal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">nullOnOverflow</span></span></em><span class="optional">]</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">decimal</span></span></span><a class="headerlink" href="#make_decimal" title="Link to this definition">¶</a></dt>
<dd><p>Create <code class="docutils literal notranslate"><span class="pre">decimal</span></code> of requsted precision and scale from an unscaled bigint value <code class="docutils literal notranslate"><span class="pre">x</span></code>.
By default, the value of <code class="docutils literal notranslate"><span class="pre">nullOnOverflow</span></code> is true, and null will be returned when <code class="docutils literal notranslate"><span class="pre">x</span></code> is too large for the result precision.
Otherwise, exception will be thrown when <code class="docutils literal notranslate"><span class="pre">x</span></code> overflows.</p>
</dd></dl>

</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Decimal Operators</a><ul>
<li><a class="reference internal" href="#decimal-precision-and-scale-computation-formulas">Decimal Precision and Scale Computation Formulas</a><ul>
<li><a class="reference internal" href="#addition-and-subtraction">Addition and Subtraction</a></li>
<li><a class="reference internal" href="#multiplication">Multiplication</a></li>
<li><a class="reference internal" href="#division">Division</a></li>
<li><a class="reference internal" href="#integer-division">Integer Division</a></li>
</ul>
</li>
<li><a class="reference internal" href="#decimal-precision-and-scale-adjustment">Decimal Precision and Scale Adjustment</a></li>
<li><a class="reference internal" href="#arithmetic-functions">Arithmetic Functions</a><ul>
<li><a class="reference internal" href="#div"><code class="docutils literal notranslate"><span class="pre">div()</span></code></a></li>
<li><a class="reference internal" href="#checked_div"><code class="docutils literal notranslate"><span class="pre">checked_div()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#decimal-functions">Decimal Functions</a><ul>
<li><a class="reference internal" href="#ceil"><code class="docutils literal notranslate"><span class="pre">ceil()</span></code></a></li>
<li><a class="reference internal" href="#decimal_equalto"><code class="docutils literal notranslate"><span class="pre">decimal_equalto()</span></code></a></li>
<li><a class="reference internal" href="#decimal_greaterthan"><code class="docutils literal notranslate"><span class="pre">decimal_greaterthan()</span></code></a></li>
<li><a class="reference internal" href="#decimal_greaterthanorequal"><code class="docutils literal notranslate"><span class="pre">decimal_greaterthanorequal()</span></code></a></li>
<li><a class="reference internal" href="#decimal_lessthan"><code class="docutils literal notranslate"><span class="pre">decimal_lessthan()</span></code></a></li>
<li><a class="reference internal" href="#decimal_lessthanorequal"><code class="docutils literal notranslate"><span class="pre">decimal_lessthanorequal()</span></code></a></li>
<li><a class="reference internal" href="#decimal_notequalto"><code class="docutils literal notranslate"><span class="pre">decimal_notequalto()</span></code></a></li>
<li><a class="reference internal" href="#floor"><code class="docutils literal notranslate"><span class="pre">floor()</span></code></a></li>
<li><a class="reference internal" href="#in"><code class="docutils literal notranslate"><span class="pre">in()</span></code></a></li>
<li><a class="reference internal" href="#unaryminus"><code class="docutils literal notranslate"><span class="pre">unaryminus()</span></code></a></li>
<li><a class="reference internal" href="#unscaled_value"><code class="docutils literal notranslate"><span class="pre">unscaled_value()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#decimal-special-forms">Decimal Special Forms</a><ul>
<li><a class="reference internal" href="#decimal_round"><code class="docutils literal notranslate"><span class="pre">decimal_round()</span></code></a></li>
<li><a class="reference internal" href="#make_decimal"><code class="docutils literal notranslate"><span class="pre">make_decimal()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="bitwise.html"
                          title="previous chapter">Bitwise Functions</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="comparison.html"
                          title="next chapter">Comparison Functions</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/functions/spark/decimal.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="comparison.html" title="Comparison Functions"
             >next</a> |</li>
        <li class="right" >
          <a href="bitwise.html" title="Bitwise Functions"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Velox  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../spark_functions.html" >Spark Functions</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Decimal Operators</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright TBD.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    </div>
  </body>
</html>