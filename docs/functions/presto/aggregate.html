<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Aggregate Functions &#8212; Velox  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/nature.css?v=0f882399" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Window functions" href="window.html" />
    <link rel="prev" title="URL Functions" href="url.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="window.html" title="Window functions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="url.html" title="URL Functions"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Velox  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../functions.html" accesskey="U">Presto Functions</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Aggregate Functions</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="aggregate-functions">
<h1>Aggregate Functions<a class="headerlink" href="#aggregate-functions" title="Link to this heading">¶</a></h1>
<p>Aggregate functions operate on a set of values to compute a single result.</p>
<p>Except for <a class="reference internal" href="#count" title="count"><code class="xref py py-func docutils literal notranslate"><span class="pre">count()</span></code></a>, <a class="reference internal" href="#count_if" title="count_if"><code class="xref py py-func docutils literal notranslate"><span class="pre">count_if()</span></code></a>, <a class="reference internal" href="#max_by" title="max_by"><code class="xref py py-func docutils literal notranslate"><span class="pre">max_by()</span></code></a>, <a class="reference internal" href="#min_by" title="min_by"><code class="xref py py-func docutils literal notranslate"><span class="pre">min_by()</span></code></a> and
<a class="reference internal" href="#approx_distinct" title="approx_distinct"><code class="xref py py-func docutils literal notranslate"><span class="pre">approx_distinct()</span></code></a>, all of these aggregate functions ignore null values
and return null for no input rows or when all values are null. For example,
<a class="reference internal" href="#sum" title="sum"><code class="xref py py-func docutils literal notranslate"><span class="pre">sum()</span></code></a> returns null rather than zero and <a class="reference internal" href="#avg" title="avg"><code class="xref py py-func docutils literal notranslate"><span class="pre">avg()</span></code></a> does not include null
values in the count. The <code class="docutils literal notranslate"><span class="pre">coalesce</span></code> function can be used to convert null into
zero.</p>
<p>Some aggregate functions such as <a class="reference internal" href="#array_agg" title="array_agg"><code class="xref py py-func docutils literal notranslate"><span class="pre">array_agg()</span></code></a> produce different results
depending on the order of input values.</p>
<section id="general-aggregate-functions">
<h2>General Aggregate Functions<a class="headerlink" href="#general-aggregate-functions" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="arbitrary">
<span class="sig-name descname"><span class="pre">arbitrary</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">[same</span> <span class="pre">as</span> <span class="pre">x]</span></span></span><a class="headerlink" href="#arbitrary" title="Link to this definition">¶</a></dt>
<dd><p>Returns an arbitrary non-null value of <code class="docutils literal notranslate"><span class="pre">x</span></code>, if one exists.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="any_value">
<span class="sig-name descname"><span class="pre">any_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">[same</span> <span class="pre">as</span> <span class="pre">x]</span></span></span><a class="headerlink" href="#any_value" title="Link to this definition">¶</a></dt>
<dd><p>This is an alias for <a class="reference internal" href="#arbitrary" title="arbitrary"><code class="xref py py-func docutils literal notranslate"><span class="pre">arbitrary()</span></code></a>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="array_agg">
<span class="sig-name descname"><span class="pre">array_agg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">array&lt;[same</span> <span class="pre">as</span> <span class="pre">x]&gt;</span></span></span><a class="headerlink" href="#array_agg" title="Link to this definition">¶</a></dt>
<dd><p>Returns an array created from the input <code class="docutils literal notranslate"><span class="pre">x</span></code> elements. Ignores null
inputs if <a class="reference internal" href="../../configs.html"><span class="doc">presto.array_agg.ignore_nulls</span></a> is set
to false.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="avg">
<span class="sig-name descname"><span class="pre">avg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">real</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">decimal</span></span></span><a class="headerlink" href="#avg" title="Link to this definition">¶</a></dt>
<dd><p>Returns the average (arithmetic mean) of all non-null input values.
When x is of type REAL, the result type is REAL.
When x is an integer or a DOUBLE, the result is DOUBLE.
When x is of type DECIMAL(p, s), the result type is DECIMAL(p, s).
Note: For the overflow cases, Velox returns a result when Presto throws “Decimal overflow”.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">AVG</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<span class="n">FROM</span> <span class="p">(</span> <span class="n">VALUES</span>
          <span class="p">(</span><span class="n">CAST</span><span class="p">(</span><span class="mf">9999999999999999999999999999999.9999999</span> <span class="n">AS</span> <span class="n">DECIMAL</span><span class="p">(</span><span class="mi">38</span><span class="p">,</span><span class="mi">7</span><span class="p">))),</span>
      <span class="p">(</span><span class="n">CAST</span><span class="p">(</span><span class="mf">9999999999999999999999999999999.9999999</span> <span class="n">AS</span> <span class="n">DECIMAL</span><span class="p">(</span><span class="mi">38</span><span class="p">,</span><span class="mi">7</span><span class="p">)))</span>
     <span class="p">)</span> <span class="n">AS</span> <span class="n">t</span><span class="p">(</span><span class="n">col</span><span class="p">);</span>
<span class="o">--</span> <span class="n">Velox</span><span class="p">:</span> <span class="mf">9999999999999999999999999999999.9999999</span>
<span class="o">--</span> <span class="n">Presto</span><span class="p">:</span> <span class="n">Decimal</span> <span class="n">overflow</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="bool_and">
<span class="sig-name descname"><span class="pre">bool_and</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">boolean</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">boolean</span></span></span><a class="headerlink" href="#bool_and" title="Link to this definition">¶</a></dt>
<dd><p>Returns <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> if every input value is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, otherwise <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="bool_or">
<span class="sig-name descname"><span class="pre">bool_or</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">boolean</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">boolean</span></span></span><a class="headerlink" href="#bool_or" title="Link to this definition">¶</a></dt>
<dd><p>Returns <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> if any input value is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, otherwise <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="checksum">
<span class="sig-name descname"><span class="pre">checksum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">varbinary</span></span></span><a class="headerlink" href="#checksum" title="Link to this definition">¶</a></dt>
<dd><p>Returns an order-insensitive checksum of the given values.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="count">
<span class="sig-name descname"><span class="pre">count</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">*</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bigint</span></span></span><a class="headerlink" href="#count" title="Link to this definition">¶</a></dt>
<dd><p>Returns the number of input rows.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">count</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bigint</span></span></span></dt>
<dd><p>Returns the number of non-null input values.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="count_if">
<span class="sig-name descname"><span class="pre">count_if</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bigint</span></span></span><a class="headerlink" href="#count_if" title="Link to this definition">¶</a></dt>
<dd><p>Returns the number of <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> input values.
This function is equivalent to <code class="docutils literal notranslate"><span class="pre">count(CASE</span> <span class="pre">WHEN</span> <span class="pre">x</span> <span class="pre">THEN</span> <span class="pre">1</span> <span class="pre">END)</span></code>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="entropy">
<span class="sig-name descname"><span class="pre">entropy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">c</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#entropy" title="Link to this definition">¶</a></dt>
<dd><p>Returns the log-2 entropy of count input-values.</p>
<div class="math notranslate nohighlight">
\[\mathrm{entropy}(c) = \sum_i \left[ {c_i \over \sum_j [c_j]} \log_2\left({\sum_j [c_j] \over c_i}\right) \right].\]</div>
<p><code class="docutils literal notranslate"><span class="pre">c</span></code> must be a <code class="docutils literal notranslate"><span class="pre">integer</span></code> column of non-negative values.</p>
<p>The function ignores any <code class="docutils literal notranslate"><span class="pre">NULL</span></code> count. If the sum of non-<code class="docutils literal notranslate"><span class="pre">NULL</span></code> counts is 0,
it returns 0.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="every">
<span class="sig-name descname"><span class="pre">every</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">boolean</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">boolean</span></span></span><a class="headerlink" href="#every" title="Link to this definition">¶</a></dt>
<dd><p>This is an alias for <a class="reference internal" href="#bool_and" title="bool_and"><code class="xref py py-func docutils literal notranslate"><span class="pre">bool_and()</span></code></a>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="histogram">
<span class="sig-name descname"><span class="pre">histogram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#histogram" title="Link to this definition">¶</a></dt>
<dd><p>Returns a map containing the count of the number of times
each input value occurs. Supports integral, floating-point,
boolean, timestamp, and date input types.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="geometric_mean">
<span class="sig-name descname"><span class="pre">geometric_mean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bigint</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#geometric_mean" title="Link to this definition">¶</a></dt>
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">geometric_mean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">double</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span></dt>
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">geometric_mean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">real</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">real</span></span></span></dt>
<dd><p>Returns the <a class="reference external" href="https://en.wikipedia.org/wiki/Geometric_mean">geometric mean</a> of all input values.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="max_by">
<span class="sig-name descname"><span class="pre">max_by</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">[same</span> <span class="pre">as</span> <span class="pre">x]</span></span></span><a class="headerlink" href="#max_by" title="Link to this definition">¶</a></dt>
<dd><p>Returns the value of <code class="docutils literal notranslate"><span class="pre">x</span></code> associated with the maximum value of <code class="docutils literal notranslate"><span class="pre">y</span></code> over all input values.
<code class="docutils literal notranslate"><span class="pre">y</span></code> must be an orderable type.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">max_by</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">n)</span> <span class="pre">-&gt;</span> <span class="pre">array([same</span> <span class="pre">as</span> <span class="pre">x]</span></em><span class="sig-paren">)</span></dt>
<dd><p>Returns n values of <code class="docutils literal notranslate"><span class="pre">x</span></code> associated with the n largest values of <code class="docutils literal notranslate"><span class="pre">y</span></code> in descending order of <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="min_by">
<span class="sig-name descname"><span class="pre">min_by</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">[same</span> <span class="pre">as</span> <span class="pre">x]</span></span></span><a class="headerlink" href="#min_by" title="Link to this definition">¶</a></dt>
<dd><p>Returns the value of <code class="docutils literal notranslate"><span class="pre">x</span></code> associated with the minimum value of <code class="docutils literal notranslate"><span class="pre">y</span></code> over all input values.
<code class="docutils literal notranslate"><span class="pre">y</span></code> must be an orderable type.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">min_by</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">n)</span> <span class="pre">-&gt;</span> <span class="pre">array([same</span> <span class="pre">as</span> <span class="pre">x]</span></em><span class="sig-paren">)</span></dt>
<dd><p>Returns n values of <code class="docutils literal notranslate"><span class="pre">x</span></code> associated with the n smallest values of <code class="docutils literal notranslate"><span class="pre">y</span></code> in ascending order of <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="max">
<span class="sig-name descname"><span class="pre">max</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">[same</span> <span class="pre">as</span> <span class="pre">x]</span></span></span><a class="headerlink" href="#max" title="Link to this definition">¶</a></dt>
<dd><p>Returns the maximum value of all input values.
<code class="docutils literal notranslate"><span class="pre">x</span></code> must not contain nulls when it is complex type.
<code class="docutils literal notranslate"><span class="pre">x</span></code> must be an orderable type.
Nulls are ignored if there are any non-null inputs.
For REAL and DOUBLE types, NaN is considered greater than Infinity.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">max</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">array&lt;[same</span> <span class="pre">as</span> <span class="pre">x]&gt;</span></span></span></dt>
<dd><p>Returns <code class="docutils literal notranslate"><span class="pre">n</span></code> largest values of all input values of <code class="docutils literal notranslate"><span class="pre">x</span></code>.
<code class="docutils literal notranslate"><span class="pre">n</span></code> must be a positive integer and not exceed 10’000.
Currently not supported for ARRAY, MAP, and ROW input types.
Nulls are not included in the output array.
For REAL and DOUBLE types, NaN is considered greater than Infinity.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="min">
<span class="sig-name descname"><span class="pre">min</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">[same</span> <span class="pre">as</span> <span class="pre">x]</span></span></span><a class="headerlink" href="#min" title="Link to this definition">¶</a></dt>
<dd><p>Returns the minimum value of all input values.
<code class="docutils literal notranslate"><span class="pre">x</span></code> must not contain nulls when it is complex type.
<code class="docutils literal notranslate"><span class="pre">x</span></code> must be an orderable type.
Nulls are ignored if there are any non-null inputs.
For REAL and DOUBLE types, NaN is considered greater than Infinity.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">min</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">array&lt;[same</span> <span class="pre">as</span> <span class="pre">x]&gt;</span></span></span></dt>
<dd><p>Returns <code class="docutils literal notranslate"><span class="pre">n</span></code> smallest values of all input values of <code class="docutils literal notranslate"><span class="pre">x</span></code>.
<code class="docutils literal notranslate"><span class="pre">n</span></code> must be a positive integer and not exceed 10’000.
Currently not supported for ARRAY, MAP, and ROW input types.
Nulls are not included in output array.
For REAL and DOUBLE types, NaN is considered greater than Infinity.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="multimap_agg">
<span class="sig-name descname"><span class="pre">multimap_agg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">K</span> <span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span> <span class="pre">value)</span> <span class="pre">-&gt;</span> <span class="pre">map(K</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">array(V)</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#multimap_agg" title="Link to this definition">¶</a></dt>
<dd><p>Returns a multimap created from the input <code class="docutils literal notranslate"><span class="pre">key</span></code> / <code class="docutils literal notranslate"><span class="pre">value</span></code> pairs.
Each key can be associated with multiple values.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="reduce_agg">
<span class="sig-name descname"><span class="pre">reduce_agg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">inputValue</span> <span class="pre">T</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initialState</span> <span class="pre">S</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inputFunction(S</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">S)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">combineFunction(S</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">S</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">S)</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">S</span></span></span><a class="headerlink" href="#reduce_agg" title="Link to this definition">¶</a></dt>
<dd><p>Reduces all non-NULL input values into a single value. <code class="docutils literal notranslate"><span class="pre">inputFunction</span></code>
will be invoked for each non-NULL input value. If all inputs are NULL, the
result is NULL. In addition to taking the input value, <code class="docutils literal notranslate"><span class="pre">inputFunction</span></code>
takes the current state, initially <code class="docutils literal notranslate"><span class="pre">initialState</span></code>, and returns the new state.
<code class="docutils literal notranslate"><span class="pre">combineFunction</span></code> will be invoked to combine two states into a new state.
The final state is returned. Throws an error if <code class="docutils literal notranslate"><span class="pre">initialState</span></code> is NULL or
<code class="docutils literal notranslate"><span class="pre">inputFunction</span></code> or <code class="docutils literal notranslate"><span class="pre">combineFunction</span></code> returns a NULL.</p>
<p>Take care when designing <code class="docutils literal notranslate"><span class="pre">initialState</span></code>, <code class="docutils literal notranslate"><span class="pre">inputFunction</span></code> and <code class="docutils literal notranslate"><span class="pre">combineFunction</span></code>.
These need to support evaluating aggregation in a distributed manner using partial
aggregation on many nodes, followed by shuffle over group-by keys, followed by
final aggregation. Given a set of all possible values of state, make sure that
combineFunction is <a class="reference external" href="https://en.wikipedia.org/wiki/Commutative_property">commutative</a>
and <a class="reference external" href="https://en.wikipedia.org/wiki/Associative_property">associative</a>
operation with initialState as the
<a class="reference external" href="https://en.wikipedia.org/wiki/Identity_element">identity</a> value.</p>
<blockquote>
<div><p>combineFunction(s, initialState) = s for any s</p>
<p>combineFunction(s1, s2) = combineFunction(s2, s1) for any s1 and s2</p>
<p>combineFunction(s1, combineFunction(s2, s3)) = combineFunction(combineFunction(s1, s2), s3) for any s1, s2, s3</p>
</div></blockquote>
<p>In addition, make sure that the following holds for the inputFunction:</p>
<blockquote>
<div><p>inputFunction(inputFunction(initialState, x), y) = combineFunction(inputFunction(initialState, x), inputFunction(initialState, y)) for any x and y</p>
</div></blockquote>
<p>Check out <a class="reference external" href="https://velox-lib.io/blog/reduce-agg">blog post about reduce_agg</a> for more context.</p>
<p>Note that reduce_agg doesn’t support evaluation over sorted inputs.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span> <span class="n">Compute</span> <span class="nb">sum</span> <span class="p">(</span><span class="k">for</span> <span class="n">illustration</span> <span class="n">purposes</span> <span class="n">only</span><span class="p">;</span> <span class="n">use</span> <span class="n">SUM</span> <span class="n">aggregate</span> <span class="n">function</span> <span class="ow">in</span> <span class="n">production</span> <span class="n">queries</span><span class="p">)</span><span class="o">.</span>
<span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span> <span class="n">reduce_agg</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
<span class="n">FROM</span> <span class="p">(</span>
    <span class="n">VALUES</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
<span class="p">)</span> <span class="n">AS</span> <span class="n">t</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="n">GROUP</span> <span class="n">BY</span> <span class="nb">id</span><span class="p">;</span>
<span class="o">--</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="o">--</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>

<span class="o">--</span> <span class="n">Compute</span> <span class="n">product</span><span class="o">.</span>
<span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span> <span class="n">reduce_agg</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span>
<span class="n">FROM</span> <span class="p">(</span>
    <span class="n">VALUES</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
<span class="p">)</span> <span class="n">AS</span> <span class="n">t</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="n">GROUP</span> <span class="n">BY</span> <span class="nb">id</span><span class="p">;</span>
<span class="o">--</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
<span class="o">--</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">24000</span><span class="p">)</span>

<span class="o">--</span> <span class="n">Compute</span> <span class="n">avg</span> <span class="p">(</span><span class="k">for</span> <span class="n">illustration</span> <span class="n">purposes</span> <span class="n">only</span><span class="p">;</span> <span class="n">use</span> <span class="n">AVG</span> <span class="n">aggregate</span> <span class="n">function</span> <span class="ow">in</span> <span class="n">production</span> <span class="n">queries</span><span class="p">)</span><span class="o">.</span>
<span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span> <span class="n">sum_and_count</span><span class="o">.</span><span class="n">sum</span> <span class="o">/</span> <span class="n">sum_and_count</span><span class="o">.</span><span class="n">count</span> <span class="n">FROM</span> <span class="p">(</span>
  <span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span> <span class="n">reduce_agg</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">CAST</span><span class="p">(</span><span class="n">row</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="n">AS</span> <span class="n">row</span><span class="p">(</span><span class="nb">sum</span> <span class="n">double</span><span class="p">,</span> <span class="n">count</span> <span class="n">bigint</span><span class="p">)),</span>
    <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CAST</span><span class="p">(</span><span class="n">row</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">sum</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="n">AS</span> <span class="n">row</span><span class="p">(</span><span class="nb">sum</span> <span class="n">double</span><span class="p">,</span> <span class="n">count</span> <span class="n">bigint</span><span class="p">)),</span>
    <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CAST</span><span class="p">(</span><span class="n">row</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">sum</span> <span class="o">+</span> <span class="n">s2</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">count</span> <span class="o">+</span> <span class="n">s2</span><span class="o">.</span><span class="n">count</span><span class="p">)</span> <span class="n">AS</span> <span class="n">row</span><span class="p">(</span><span class="nb">sum</span> <span class="n">double</span><span class="p">,</span> <span class="n">count</span> <span class="n">bigint</span><span class="p">)))</span> <span class="n">AS</span> <span class="n">sum_and_count</span>
  <span class="n">FROM</span> <span class="p">(</span>
       <span class="n">VALUES</span>
           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
           <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
           <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
   <span class="p">)</span> <span class="n">AS</span> <span class="n">t</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
   <span class="n">GROUP</span> <span class="n">BY</span> <span class="nb">id</span>
<span class="p">);</span>
<span class="o">--</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)</span>
<span class="o">--</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="set_agg">
<span class="sig-name descname"><span class="pre">set_agg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">array&lt;[same</span> <span class="pre">as</span> <span class="pre">x]&gt;</span></span></span><a class="headerlink" href="#set_agg" title="Link to this definition">¶</a></dt>
<dd><p>Returns an array created from the distinct input <code class="docutils literal notranslate"><span class="pre">x</span></code> elements.
<code class="docutils literal notranslate"><span class="pre">x</span></code> must not contain nulls when it is complex type.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="set_union">
<span class="sig-name descname"><span class="pre">set_union</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array(T))</span> <span class="pre">-&gt;</span> <span class="pre">array(T</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#set_union" title="Link to this definition">¶</a></dt>
<dd><p>Returns an array of all the distinct values contained in each array of the input.</p>
<p>Returns an empty array if all input arrays are NULL.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">set_union</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
<span class="n">FROM</span> <span class="p">(</span>
    <span class="n">VALUES</span>
        <span class="n">ARRAY</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="n">ARRAY</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="p">)</span> <span class="n">AS</span> <span class="n">t</span><span class="p">(</span><span class="n">elements</span><span class="p">);</span>
</pre></div>
</div>
<p>Returns ARRAY[1, 2, 3, 4]</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sum">
<span class="sig-name descname"><span class="pre">sum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">[same</span> <span class="pre">as</span> <span class="pre">x]</span></span></span><a class="headerlink" href="#sum" title="Link to this definition">¶</a></dt>
<dd><p>Returns the sum of all input values.</p>
</dd></dl>

</section>
<section id="bitwise-aggregate-functions">
<h2>Bitwise Aggregate Functions<a class="headerlink" href="#bitwise-aggregate-functions" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="bitwise_and_agg">
<span class="sig-name descname"><span class="pre">bitwise_and_agg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">[same</span> <span class="pre">as</span> <span class="pre">x]</span></span></span><a class="headerlink" href="#bitwise_and_agg" title="Link to this definition">¶</a></dt>
<dd><p>Returns the bitwise AND of all input values in 2’s complement representation.</p>
<p>Supported types are TINYINT, SMALLINT, INTEGER and BIGINT.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="bitwise_or_agg">
<span class="sig-name descname"><span class="pre">bitwise_or_agg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">[same</span> <span class="pre">as</span> <span class="pre">x]</span></span></span><a class="headerlink" href="#bitwise_or_agg" title="Link to this definition">¶</a></dt>
<dd><p>Returns the bitwise OR of all input values in 2’s complement representation.</p>
<p>Supported types are TINYINT, SMALLINT, INTEGER and BIGINT.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="bitwise_xor_agg">
<span class="sig-name descname"><span class="pre">bitwise_xor_agg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">[same</span> <span class="pre">as</span> <span class="pre">x]</span></span></span><a class="headerlink" href="#bitwise_xor_agg" title="Link to this definition">¶</a></dt>
<dd><p>Returns the bitwise XOR of all input values in 2’s complement representation.</p>
<p>Supported types are TINYINT, SMALLINT, INTEGER and BIGINT.</p>
</dd></dl>

</section>
<section id="map-aggregate-functions">
<h2>Map Aggregate Functions<a class="headerlink" href="#map-aggregate-functions" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="map_agg">
<span class="sig-name descname"><span class="pre">map_agg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">K</span> <span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span> <span class="pre">value)</span> <span class="pre">-&gt;</span> <span class="pre">map(K</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#map_agg" title="Link to this definition">¶</a></dt>
<dd><p>Returns a map created from the input <code class="docutils literal notranslate"><span class="pre">key</span></code> / <code class="docutils literal notranslate"><span class="pre">value</span></code> pairs. Inputs with NULL or duplicate keys are ignored.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="map_union">
<span class="sig-name descname"><span class="pre">map_union</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">map(K</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V))</span> <span class="pre">-&gt;</span> <span class="pre">map(K</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#map_union" title="Link to this definition">¶</a></dt>
<dd><p>Returns the union of all the input <code class="docutils literal notranslate"><span class="pre">maps</span></code>.
If a <code class="docutils literal notranslate"><span class="pre">key</span></code> is found in multiple input <code class="docutils literal notranslate"><span class="pre">maps</span></code>,
that <code class="docutils literal notranslate"><span class="pre">key’s</span></code> <code class="docutils literal notranslate"><span class="pre">value</span></code> in the resulting <code class="docutils literal notranslate"><span class="pre">map</span></code> comes from an arbitrary input <code class="docutils literal notranslate"><span class="pre">map</span></code>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="map_union_sum">
<span class="sig-name descname"><span class="pre">map_union_sum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">map(K</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V))</span> <span class="pre">-&gt;</span> <span class="pre">map(K</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#map_union_sum" title="Link to this definition">¶</a></dt>
<dd><p>Returns the union of all the input maps summing the values of matching keys in all
the maps. All null values in the original maps are coalesced to 0.</p>
</dd></dl>

</section>
<section id="approximate-aggregate-functions">
<h2>Approximate Aggregate Functions<a class="headerlink" href="#approximate-aggregate-functions" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="approx_distinct">
<span class="sig-name descname"><span class="pre">approx_distinct</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bigint</span></span></span><a class="headerlink" href="#approx_distinct" title="Link to this definition">¶</a></dt>
<dd><p>Returns the approximate number of distinct input values.
This function provides an approximation of <code class="docutils literal notranslate"><span class="pre">count(DISTINCT</span> <span class="pre">x)</span></code>.
Zero is returned if all input values are null.</p>
<p>This function should produce a standard error of 2.3%, which is the
standard deviation of the (approximately normal) error distribution over
all possible sets. It does not guarantee an upper bound on the error for
any specific input set.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">approx_distinct</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">e</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bigint</span></span></span></dt>
<dd><blockquote>
<div><p>Returns the approximate number of distinct input values.
This function provides an approximation of <code class="docutils literal notranslate"><span class="pre">count(DISTINCT</span> <span class="pre">x)</span></code>.
Zero is returned if all input values are null.</p>
<p>This function should produce a standard error of no more than <code class="docutils literal notranslate"><span class="pre">e</span></code>, which
is the standard deviation of the (approximately normal) error distribution
over all possible sets. It does not guarantee an upper bound on the error
for any specific input set. The current implementation of this function
requires that <code class="docutils literal notranslate"><span class="pre">e</span></code> be in the range of <code class="docutils literal notranslate"><span class="pre">[0.0040625,</span> <span class="pre">0.26000]</span></code>.</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="approx_most_frequent">
<span class="sig-name descname"><span class="pre">approx_most_frequent</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">buckets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">capacity</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">map&lt;[same</span> <span class="pre">as</span> <span class="pre">value],</span> <span class="pre">bigint&gt;</span></span></span><a class="headerlink" href="#approx_most_frequent" title="Link to this definition">¶</a></dt>
<dd><p>Computes the top frequent values up to <code class="docutils literal notranslate"><span class="pre">buckets</span></code> elements approximately.
Approximate estimation of the function enables us to pick up the frequent
values with less memory.  Larger <code class="docutils literal notranslate"><span class="pre">capacity</span></code> improves the accuracy of
underlying algorithm with sacrificing the memory capacity.  The returned
value is a map containing the top elements with corresponding estimated
frequency.</p>
<p>For BOOLEAN ‘value’, this function always returns ‘perfect’ result.
‘bucket’ and ‘capacity’ arguments are ignored in this case.</p>
<p>The error of the function depends on the permutation of the values and its
cardinality.  We can set the capacity same as the cardinality of the
underlying data to achieve the least error.</p>
<p><code class="docutils literal notranslate"><span class="pre">buckets</span></code> and <code class="docutils literal notranslate"><span class="pre">capacity</span></code> must be <code class="docutils literal notranslate"><span class="pre">bigint</span></code>.  <code class="docutils literal notranslate"><span class="pre">value</span></code> can be numeric
or string type.</p>
<p>The function uses the stream summary data structure proposed in the paper
<a class="reference external" href="https://www.cse.ust.hk/~raywong/comp5331/References/EfficientComputationOfFrequentAndTop-kElementsInDataStreams.pdf">Efficient computation of frequent and top-k elements in data streams</a>
by A. Metwally, D. Agrawal and A. Abbadi.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="approx_percentile">
<span class="sig-name descname"><span class="pre">approx_percentile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentage</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">[same</span> <span class="pre">as</span> <span class="pre">x]</span></span></span><a class="headerlink" href="#approx_percentile" title="Link to this definition">¶</a></dt>
<dd><p>Returns the approximate percentile for all input values of <code class="docutils literal notranslate"><span class="pre">x</span></code> at the
given <code class="docutils literal notranslate"><span class="pre">percentage</span></code>. The value of <code class="docutils literal notranslate"><span class="pre">percentage</span></code> must be between zero and
one and must be constant for all input rows.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">approx_percentile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentage</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">accuracy</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">[same</span> <span class="pre">as</span> <span class="pre">x]</span></span></span></dt>
<dd><blockquote>
<div><p>As <code class="docutils literal notranslate"><span class="pre">approx_percentile(x,</span> <span class="pre">percentage)</span></code>, but with a maximum rank
error of <code class="docutils literal notranslate"><span class="pre">accuracy</span></code>. The value of <code class="docutils literal notranslate"><span class="pre">accuracy</span></code> must be between
zero and one (exclusive) and must be constant for all input rows.
Note that a lower “accuracy” is really a lower error threshold,
and thus more accurate.  The default accuracy is 0.0133.  The
underlying implementation is KLL sketch thus has a stronger
guarantee for accuracy than T-Digest.</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">approx_percentile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentages</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">array&lt;[same</span> <span class="pre">as</span> <span class="pre">x]&gt;</span></span></span></dt>
<dd><blockquote>
<div><p>Returns the approximate percentile for all input values of <code class="docutils literal notranslate"><span class="pre">x</span></code> at each of
the specified percentages. Each element of the <code class="docutils literal notranslate"><span class="pre">percentages</span></code> array must be
between zero and one, and the array must be constant for all input rows.</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">approx_percentile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentages</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">accuracy</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">array&lt;[same</span> <span class="pre">as</span> <span class="pre">x]&gt;</span></span></span></dt>
<dd><blockquote>
<div><p>As <code class="docutils literal notranslate"><span class="pre">approx_percentile(x,</span> <span class="pre">percentages)</span></code>, but with a maximum rank error of
<code class="docutils literal notranslate"><span class="pre">accuracy</span></code>.</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">approx_percentile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentage</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">[same</span> <span class="pre">as</span> <span class="pre">x]</span></span></span></dt>
<dd><blockquote>
<div><p>Returns the approximate weighed percentile for all input values of <code class="docutils literal notranslate"><span class="pre">x</span></code>
using the per-item weight <code class="docutils literal notranslate"><span class="pre">w</span></code> at the percentage <code class="docutils literal notranslate"><span class="pre">p</span></code>. The weight must be
an integer value of at least one. It is effectively a replication count for
the value <code class="docutils literal notranslate"><span class="pre">x</span></code> in the percentile set. The value of <code class="docutils literal notranslate"><span class="pre">p</span></code> must be between
zero and one and must be constant for all input rows.</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">approx_percentile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentage</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">accuracy</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">[same</span> <span class="pre">as</span> <span class="pre">x]</span></span></span></dt>
<dd><blockquote>
<div><p>As <code class="docutils literal notranslate"><span class="pre">approx_percentile(x,</span> <span class="pre">w,</span> <span class="pre">percentage)</span></code>, but with a maximum
rank error of <code class="docutils literal notranslate"><span class="pre">accuracy</span></code>.</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">approx_percentile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentages</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">array&lt;[same</span> <span class="pre">as</span> <span class="pre">x]&gt;</span></span></span></dt>
<dd><blockquote>
<div><p>Returns the approximate weighed percentile for all input values of <code class="docutils literal notranslate"><span class="pre">x</span></code>
using the per-item weight <code class="docutils literal notranslate"><span class="pre">w</span></code> at each of the given percentages specified
in the array. The weight must be an integer value of at least one. It is
effectively a replication count for the value <code class="docutils literal notranslate"><span class="pre">x</span></code> in the percentile
set. Each element of the array must be between zero and one, and the array
must be constant for all input rows.</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">approx_percentile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentages</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">accuracy</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">array&lt;[same</span> <span class="pre">as</span> <span class="pre">x]&gt;</span></span></span></dt>
<dd><blockquote>
<div><p>As <code class="docutils literal notranslate"><span class="pre">approx_percentile(x,</span> <span class="pre">w,</span> <span class="pre">percentages)</span></code>, but with a maximum rank error
of <code class="docutils literal notranslate"><span class="pre">accuracy</span></code>.</p>
</div></blockquote>
</dd></dl>

</section>
<section id="classification-metrics-aggregate-functions">
<h2>Classification Metrics Aggregate Functions<a class="headerlink" href="#classification-metrics-aggregate-functions" title="Link to this heading">¶</a></h2>
<p>The following functions each measure how some metric of a binary
<a class="reference external" href="https://en.wikipedia.org/wiki/Confusion_matrix">confusion matrix</a> changes as a function of
classification thresholds. They are meant to be used in conjunction.</p>
<p>For example, to find the <a class="reference external" href="https://en.wikipedia.org/wiki/Precision_and_recall">precision-recall curve</a>, use</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>WITH
    recall_precision AS (
        SELECT
            CLASSIFICATION_RECALL(10000, correct, pred) AS recalls,
            CLASSIFICATION_PRECISION(10000, correct, pred) AS precisions
        FROM
           classification_dataset
    )
SELECT
    recall,
    precision
FROM
    recall_precision
CROSS JOIN UNNEST(recalls, precisions) AS t(recall, precision)
</pre></div>
</div>
</div></blockquote>
<p>To get the corresponding thresholds for these values, use</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>WITH
    recall_precision AS (
        SELECT
            CLASSIFICATION_THRESHOLDS(10000, correct, pred) AS thresholds,
            CLASSIFICATION_RECALL(10000, correct, pred) AS recalls,
            CLASSIFICATION_PRECISION(10000, correct, pred) AS precisions
        FROM
           classification_dataset
    )
SELECT
    threshold,
    recall,
    precision
FROM
    recall_precision
CROSS JOIN UNNEST(thresholds, recalls, precisions) AS t(threshold, recall, precision)
</pre></div>
</div>
</div></blockquote>
<p>To find the <a class="reference external" href="https://en.wikipedia.org/wiki/Receiver_operating_characteristic">ROC curve</a>, use</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>WITH
    fallout_recall AS (
        SELECT
            CLASSIFICATION_FALLOUT(10000, correct, pred) AS fallouts,
            CLASSIFICATION_RECALL(10000, correct, pred) AS recalls
        FROM
           classification_dataset
    )
SELECT
    fallout
    recall,
FROM
    recall_fallout
CROSS JOIN UNNEST(fallouts, recalls) AS t(fallout, recall)
</pre></div>
</div>
</div></blockquote>
<dl class="py function">
<dt class="sig sig-object py" id="classification_miss_rate">
<span class="sig-name descname"><span class="pre">classification_miss_rate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">buckets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">array&lt;double&gt;</span></span></span><a class="headerlink" href="#classification_miss_rate" title="Link to this definition">¶</a></dt>
<dd><p>Computes the miss-rate with up to <code class="docutils literal notranslate"><span class="pre">buckets</span></code> number of buckets. Returns
an array of miss-rate values.</p>
<p><code class="docutils literal notranslate"><span class="pre">y</span></code> should be a boolean outcome value; <code class="docutils literal notranslate"><span class="pre">x</span></code> should be predictions, each
between 0 and 1; <code class="docutils literal notranslate"><span class="pre">weight</span></code> should be non-negative values, indicating the weight of the instance.</p>
<p>The
<a class="reference external" href="https://en.wikipedia.org/wiki/Type_I_and_type_II_errors#False_positive_and_false_negative_rates">miss-rate</a>
is defined as a sequence whose <span class="math notranslate nohighlight">\(j\)</span>-th entry is</p>
<div class="math notranslate nohighlight">
\[{
    \sum_{i \;|\; x_i \leq t_j \bigwedge y_i = 1} \left[ w_i \right]
    \over
    \sum_{i \;|\; x_i \leq t_j \bigwedge y_i = 1} \left[ w_i \right]
    +
    \sum_{i \;|\; x_i &gt; t_j \bigwedge y_i = 1} \left[ w_i \right]
},\]</div>
<p>where <span class="math notranslate nohighlight">\(t_j\)</span> is the <span class="math notranslate nohighlight">\(j\)</span>-th smallest threshold,
and <span class="math notranslate nohighlight">\(y_i\)</span>, <span class="math notranslate nohighlight">\(x_i\)</span>, and <span class="math notranslate nohighlight">\(w_i\)</span> are the <span class="math notranslate nohighlight">\(i\)</span>-th
entries of <code class="docutils literal notranslate"><span class="pre">y</span></code>, <code class="docutils literal notranslate"><span class="pre">x</span></code>, and <code class="docutils literal notranslate"><span class="pre">weight</span></code>, respectively.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id0">
<span class="sig-name descname"><span class="pre">classification_miss_rate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">buckets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">array&lt;double&gt;</span></span></span><a class="headerlink" href="#id0" title="Link to this definition">¶</a></dt>
<dd><p>This function is equivalent to the variant of
<code class="xref py py-func docutils literal notranslate"><span class="pre">classification_miss_rate()</span></code> that takes a <code class="docutils literal notranslate"><span class="pre">weight</span></code>, with a per-item weight of <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="classification_fall_out">
<span class="sig-name descname"><span class="pre">classification_fall_out</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">buckets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">array&lt;double&gt;</span></span></span><a class="headerlink" href="#classification_fall_out" title="Link to this definition">¶</a></dt>
<dd><p>Computes the fall-out with up to <code class="docutils literal notranslate"><span class="pre">buckets</span></code> number of buckets. Returns
an array of fall-out values.</p>
<p><code class="docutils literal notranslate"><span class="pre">y</span></code> should be a boolean outcome value; <code class="docutils literal notranslate"><span class="pre">x</span></code> should be predictions, each
between 0 and 1; <code class="docutils literal notranslate"><span class="pre">weight</span></code> should be non-negative values, indicating the weight of the instance.</p>
<p>The
<a class="reference external" href="https://en.wikipedia.org/wiki/Information_retrieval#Fall-out">fall-out</a>
is defined as a sequence whose <span class="math notranslate nohighlight">\(j\)</span>-th entry is</p>
<div class="math notranslate nohighlight">
\[{
    \sum_{i \;|\; x_i &gt; t_j \bigwedge y_i = 0} \left[ w_i \right]
    \over
    \sum_{i \;|\; y_i = 0} \left[ w_i \right]
},\]</div>
<p>where <span class="math notranslate nohighlight">\(t_j\)</span> is the <span class="math notranslate nohighlight">\(j\)</span>-th smallest threshold,
and <span class="math notranslate nohighlight">\(y_i\)</span>, <span class="math notranslate nohighlight">\(x_i\)</span>, and <span class="math notranslate nohighlight">\(w_i\)</span> are the <span class="math notranslate nohighlight">\(i\)</span>-th
entries of <code class="docutils literal notranslate"><span class="pre">y</span></code>, <code class="docutils literal notranslate"><span class="pre">x</span></code>, and <code class="docutils literal notranslate"><span class="pre">weight</span></code>, respectively.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id2">
<span class="sig-name descname"><span class="pre">classification_fall_out</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">buckets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">array&lt;double&gt;</span></span></span><a class="headerlink" href="#id2" title="Link to this definition">¶</a></dt>
<dd><p>This function is equivalent to the variant of
<code class="xref py py-func docutils literal notranslate"><span class="pre">classification_fall_out()</span></code> that takes a <code class="docutils literal notranslate"><span class="pre">weight</span></code>, with a per-item weight of <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="classification_precision">
<span class="sig-name descname"><span class="pre">classification_precision</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">buckets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">array&lt;double&gt;</span></span></span><a class="headerlink" href="#classification_precision" title="Link to this definition">¶</a></dt>
<dd><p>Computes the precision with up to <code class="docutils literal notranslate"><span class="pre">buckets</span></code> number of buckets. Returns
an array of precision values.</p>
<p><code class="docutils literal notranslate"><span class="pre">y</span></code> should be a boolean outcome value; <code class="docutils literal notranslate"><span class="pre">x</span></code> should be predictions, each
between 0 and 1; <code class="docutils literal notranslate"><span class="pre">weight</span></code> should be non-negative values, indicating the weight of the instance.</p>
<p>The
<a class="reference external" href="https://en.wikipedia.org/wiki/Positive_and_negative_predictive_values">precision</a>
is defined as a sequence whose <span class="math notranslate nohighlight">\(j\)</span>-th entry is</p>
<div class="math notranslate nohighlight">
\[{
    \sum_{i \;|\; x_i &gt; t_j \bigwedge y_i = 1} \left[ w_i \right]
    \over
    \sum_{i \;|\; x_i &gt; t_j} \left[ w_i \right]
},\]</div>
<p>where <span class="math notranslate nohighlight">\(t_j\)</span> is the <span class="math notranslate nohighlight">\(j\)</span>-th smallest threshold,
and <span class="math notranslate nohighlight">\(y_i\)</span>, <span class="math notranslate nohighlight">\(x_i\)</span>, and <span class="math notranslate nohighlight">\(w_i\)</span> are the <span class="math notranslate nohighlight">\(i\)</span>-th
entries of <code class="docutils literal notranslate"><span class="pre">y</span></code>, <code class="docutils literal notranslate"><span class="pre">x</span></code>, and <code class="docutils literal notranslate"><span class="pre">weight</span></code>, respectively.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id3">
<span class="sig-name descname"><span class="pre">classification_precision</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">buckets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">array&lt;double&gt;</span></span></span><a class="headerlink" href="#id3" title="Link to this definition">¶</a></dt>
<dd><p>This function is equivalent to the variant of
<code class="xref py py-func docutils literal notranslate"><span class="pre">classification_precision()</span></code> that takes a <code class="docutils literal notranslate"><span class="pre">weight</span></code>, with a per-item weight of <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="classification_recall">
<span class="sig-name descname"><span class="pre">classification_recall</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">buckets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">array&lt;double&gt;</span></span></span><a class="headerlink" href="#classification_recall" title="Link to this definition">¶</a></dt>
<dd><p>Computes the recall with up to <code class="docutils literal notranslate"><span class="pre">buckets</span></code> number of buckets. Returns
an array of recall values.</p>
<p><code class="docutils literal notranslate"><span class="pre">y</span></code> should be a boolean outcome value; <code class="docutils literal notranslate"><span class="pre">x</span></code> should be predictions, each
between 0 and 1; <code class="docutils literal notranslate"><span class="pre">weight</span></code> should be non-negative values, indicating the weight of the instance.</p>
<p>The
<a class="reference external" href="https://en.wikipedia.org/wiki/Precision_and_recall#Recall">recall</a>
is defined as a sequence whose <span class="math notranslate nohighlight">\(j\)</span>-th entry is</p>
<div class="math notranslate nohighlight">
\[{
    \sum_{i \;|\; x_i &gt; t_j \bigwedge y_i = 1} \left[ w_i \right]
    \over
    \sum_{i \;|\; y_i = 1} \left[ w_i \right]
},\]</div>
<p>where <span class="math notranslate nohighlight">\(t_j\)</span> is the <span class="math notranslate nohighlight">\(j\)</span>-th smallest threshold,
and <span class="math notranslate nohighlight">\(y_i\)</span>, <span class="math notranslate nohighlight">\(x_i\)</span>, and <span class="math notranslate nohighlight">\(w_i\)</span> are the <span class="math notranslate nohighlight">\(i\)</span>-th
entries of <code class="docutils literal notranslate"><span class="pre">y</span></code>, <code class="docutils literal notranslate"><span class="pre">x</span></code>, and <code class="docutils literal notranslate"><span class="pre">weight</span></code>, respectively.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id4">
<span class="sig-name descname"><span class="pre">classification_recall</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">buckets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">array&lt;double&gt;</span></span></span><a class="headerlink" href="#id4" title="Link to this definition">¶</a></dt>
<dd><p>This function is equivalent to the variant of
<code class="xref py py-func docutils literal notranslate"><span class="pre">classification_recall()</span></code> that takes a <code class="docutils literal notranslate"><span class="pre">weight</span></code>, with a per-item weight of <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="classification_thresholds">
<span class="sig-name descname"><span class="pre">classification_thresholds</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">buckets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">array&lt;double&gt;</span></span></span><a class="headerlink" href="#classification_thresholds" title="Link to this definition">¶</a></dt>
<dd><p>Computes the thresholds with up to <code class="docutils literal notranslate"><span class="pre">buckets</span></code> number of buckets. Returns
an array of threshold values.</p>
<p><code class="docutils literal notranslate"><span class="pre">y</span></code> should be a boolean outcome value; <code class="docutils literal notranslate"><span class="pre">x</span></code> should be predictions, each
between 0 and 1.</p>
<p>The thresholds are defined as a sequence whose <span class="math notranslate nohighlight">\(j\)</span>-th entry is the <span class="math notranslate nohighlight">\(j\)</span>-th smallest threshold.</p>
</dd></dl>

</section>
<section id="statistical-aggregate-functions">
<h2>Statistical Aggregate Functions<a class="headerlink" href="#statistical-aggregate-functions" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="corr">
<span class="sig-name descname"><span class="pre">corr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#corr" title="Link to this definition">¶</a></dt>
<dd><p>Returns correlation coefficient of input values.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="covar_pop">
<span class="sig-name descname"><span class="pre">covar_pop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#covar_pop" title="Link to this definition">¶</a></dt>
<dd><p>Returns the population covariance of input values.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="covar_samp">
<span class="sig-name descname"><span class="pre">covar_samp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#covar_samp" title="Link to this definition">¶</a></dt>
<dd><p>Returns the sample covariance of input values.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kurtosis">
<span class="sig-name descname"><span class="pre">kurtosis</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#kurtosis" title="Link to this definition">¶</a></dt>
<dd><blockquote>
<div><p>Returns the excess kurtosis of all input values. Unbiased estimate using
the following expression:</p>
<div class="math notranslate nohighlight">
\[\mathrm{kurtosis}(x) = {n(n+1) \over (n-1)(n-2)(n-3)} { \sum[(x_i-\mu)^4] \over \sigma^4} -3{ (n-1)^2 \over (n-2)(n-3) },\]</div>
</div></blockquote>
<p>where <span class="math notranslate nohighlight">\(\mu\)</span> is the mean, and <span class="math notranslate nohighlight">\(\sigma\)</span> is the standard deviation.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="regr_avgx">
<span class="sig-name descname"><span class="pre">regr_avgx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#regr_avgx" title="Link to this definition">¶</a></dt>
<dd><p>Returns the average of the independent value in a group. <code class="docutils literal notranslate"><span class="pre">y</span></code> is the dependent
value. <code class="docutils literal notranslate"><span class="pre">x</span></code> is the independent value.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="regr_avgy">
<span class="sig-name descname"><span class="pre">regr_avgy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#regr_avgy" title="Link to this definition">¶</a></dt>
<dd><p>Returns the average of the dependent value in a group. <code class="docutils literal notranslate"><span class="pre">y</span></code> is the dependent
value. <code class="docutils literal notranslate"><span class="pre">x</span></code> is the independent value.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="regr_count">
<span class="sig-name descname"><span class="pre">regr_count</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#regr_count" title="Link to this definition">¶</a></dt>
<dd><p>Returns the number of non-null pairs of input values. <code class="docutils literal notranslate"><span class="pre">y</span></code> is the dependent
value. <code class="docutils literal notranslate"><span class="pre">x</span></code> is the independent value.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="regr_intercept">
<span class="sig-name descname"><span class="pre">regr_intercept</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#regr_intercept" title="Link to this definition">¶</a></dt>
<dd><p>Returns linear regression intercept of input values. <code class="docutils literal notranslate"><span class="pre">y</span></code> is the dependent
value. <code class="docutils literal notranslate"><span class="pre">x</span></code> is the independent value.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="regr_r2">
<span class="sig-name descname"><span class="pre">regr_r2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#regr_r2" title="Link to this definition">¶</a></dt>
<dd><p>Returns the coefficient of determination of the linear regression. <code class="docutils literal notranslate"><span class="pre">y</span></code> is the dependent
value. <code class="docutils literal notranslate"><span class="pre">x</span></code> is the independent value. If regr_sxx(y, x) is 0, result is null. If regr_syy(y, x) is 0
and regr_sxx(y, x) isn’t 0, result is 1.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="regr_slope">
<span class="sig-name descname"><span class="pre">regr_slope</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#regr_slope" title="Link to this definition">¶</a></dt>
<dd><p>Returns linear regression slope of input values. <code class="docutils literal notranslate"><span class="pre">y</span></code> is the dependent
value. <code class="docutils literal notranslate"><span class="pre">x</span></code> is the independent value.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="regr_sxx">
<span class="sig-name descname"><span class="pre">regr_sxx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#regr_sxx" title="Link to this definition">¶</a></dt>
<dd><p>Returns the sum of the squares of the independent values in a group. <code class="docutils literal notranslate"><span class="pre">y</span></code> is the dependent
value. <code class="docutils literal notranslate"><span class="pre">x</span></code> is the independent value.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="regr_sxy">
<span class="sig-name descname"><span class="pre">regr_sxy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#regr_sxy" title="Link to this definition">¶</a></dt>
<dd><p>Returns the sum of the product of the dependent and independent values in a group. <code class="docutils literal notranslate"><span class="pre">y</span></code> is the dependent
value. <code class="docutils literal notranslate"><span class="pre">x</span></code> is the independent value.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="regr_syy">
<span class="sig-name descname"><span class="pre">regr_syy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#regr_syy" title="Link to this definition">¶</a></dt>
<dd><p>Returns the sum of the squares of the dependent values in a group. <code class="docutils literal notranslate"><span class="pre">y</span></code> is the dependent
value. <code class="docutils literal notranslate"><span class="pre">x</span></code> is the independent value.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skewness">
<span class="sig-name descname"><span class="pre">skewness</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#skewness" title="Link to this definition">¶</a></dt>
<dd><p>Returns the skewness of all input values.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="stddev">
<span class="sig-name descname"><span class="pre">stddev</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#stddev" title="Link to this definition">¶</a></dt>
<dd><p>This is an alias for <a class="reference internal" href="#stddev_samp" title="stddev_samp"><code class="xref py py-func docutils literal notranslate"><span class="pre">stddev_samp()</span></code></a>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="stddev_pop">
<span class="sig-name descname"><span class="pre">stddev_pop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#stddev_pop" title="Link to this definition">¶</a></dt>
<dd><p>Returns the population standard deviation of all input values.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="stddev_samp">
<span class="sig-name descname"><span class="pre">stddev_samp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#stddev_samp" title="Link to this definition">¶</a></dt>
<dd><p>Returns the sample standard deviation of all input values.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="variance">
<span class="sig-name descname"><span class="pre">variance</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#variance" title="Link to this definition">¶</a></dt>
<dd><p>This is an alias for <a class="reference internal" href="#var_samp" title="var_samp"><code class="xref py py-func docutils literal notranslate"><span class="pre">var_samp()</span></code></a>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="var_pop">
<span class="sig-name descname"><span class="pre">var_pop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#var_pop" title="Link to this definition">¶</a></dt>
<dd><p>Returns the population variance of all input values.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="var_samp">
<span class="sig-name descname"><span class="pre">var_samp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#var_samp" title="Link to this definition">¶</a></dt>
<dd><p>Returns the sample variance of all input values.</p>
</dd></dl>

</section>
<section id="noisy-aggregate-functions">
<h2>Noisy Aggregate Functions<a class="headerlink" href="#noisy-aggregate-functions" title="Link to this heading">¶</a></h2>
<section id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h3>
<p>Noisy aggregate functions provide random, noisy approximations of common
aggregations like <code class="docutils literal notranslate"><span class="pre">sum()</span></code>, <code class="docutils literal notranslate"><span class="pre">count()</span></code>, and <code class="docutils literal notranslate"><span class="pre">approx_distinct()</span></code> as well as sketches like
<code class="docutils literal notranslate"><span class="pre">approx_set()</span></code>. By injecting random noise into results, noisy aggregation functions make it
more difficult to determine or confirm the exact data that was aggregated.</p>
<p>While many of these functions resemble <a class="reference external" href="https://en.wikipedia.org/wiki/Differential_privacy">differential privacy</a>
mechanisms, neither the values returned by these functions nor the query results that incorporate
these functions are differentially private in general. See <a class="reference internal" href="#limitations">Limitations</a> below for more details.
Users who wish to support a strong privacy guarantee should discuss with a suitable technical
expert first.</p>
</section>
<section id="counts-sums-and-averages">
<h3>Counts, Sums, and Averages<a class="headerlink" href="#counts-sums-and-averages" title="Link to this heading">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="noisy_count_if_gaussian">
<span class="sig-name descname"><span class="pre">noisy_count_if_gaussian</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_scale</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">random_seed</span></span></em><span class="optional">]</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bigint</span></span></span><a class="headerlink" href="#noisy_count_if_gaussian" title="Link to this definition">¶</a></dt>
<dd><p>Counts the <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> values in <code class="docutils literal notranslate"><span class="pre">col</span></code> and then adds a normally distributed random double
value with 0 mean and standard deviation of <code class="docutils literal notranslate"><span class="pre">noise_scale</span></code> to the true count.
The noisy count is post-processed to be non-negative and rounded to bigint.</p>
<p>If provided, <code class="docutils literal notranslate"><span class="pre">random_seed</span></code> is used to seed the random number generator.
Otherwise, noise is drawn from a secure random. (<em>Note: ``random_seed`` is a constant and shared across all groups in a query.
It is kept in each accmulator to ensure the ``random_seed`` is accessible in the final aggregation step.</em>)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">noisy_count_if_gaussian</span><span class="p">(</span><span class="n">orderkey</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">lineitem</span><span class="p">;</span> <span class="o">--</span> <span class="mi">50180</span> <span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>
<span class="n">SELECT</span> <span class="n">noisy_count_if_gaussian</span><span class="p">(</span><span class="n">orderkey</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">lineitem</span> <span class="n">WHERE</span> <span class="n">false</span><span class="p">;</span> <span class="o">--</span> <span class="n">NULL</span> <span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unlike <a class="reference internal" href="#count_if" title="count_if"><code class="xref py py-func docutils literal notranslate"><span class="pre">count_if()</span></code></a>, this function returns <code class="docutils literal notranslate"><span class="pre">NULL</span></code> when the (true) count is 0.</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="noisy_count_gaussian">
<span class="sig-name descname"><span class="pre">noisy_count_gaussian</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_scale</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">random_seed</span></span></em><span class="optional">]</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bigint</span></span></span><a class="headerlink" href="#noisy_count_gaussian" title="Link to this definition">¶</a></dt>
<dd><p>Counts the non-null values in <code class="docutils literal notranslate"><span class="pre">col</span></code> and then adds a normally distributed random double
value with 0 mean and standard deviation of <code class="docutils literal notranslate"><span class="pre">noise_scale</span></code> to the true count.
The noisy count is post-processed to be non-negative and rounded to bigint.</p>
<p>If provided, <code class="docutils literal notranslate"><span class="pre">random_seed</span></code> is used to seed the random number generator.
Otherwise, noise is drawn from a secure random.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">noisy_count_gaussian</span><span class="p">(</span><span class="n">orderkey</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">lineitem</span><span class="p">;</span> <span class="o">--</span> <span class="mi">60181</span> <span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>
<span class="n">SELECT</span> <span class="n">noisy_count_gaussian</span><span class="p">(</span><span class="n">orderkey</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">lineitem</span> <span class="n">WHERE</span> <span class="n">false</span><span class="p">;</span> <span class="o">--</span> <span class="n">NULL</span> <span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unlike <code class="xref py py-func docutils literal notranslate"><span class="pre">count()</span></code>, this function returns <code class="docutils literal notranslate"><span class="pre">NULL</span></code> when the (true) count is 0.</p>
</div>
<p>Distinct counting can be performed using <a class="reference internal" href="#noisy_count_gaussian" title="noisy_count_gaussian"><code class="xref py py-func docutils literal notranslate"><span class="pre">noisy_count_gaussian()</span></code></a> <code class="docutils literal notranslate"><span class="pre">(DISTINCT</span> <span class="pre">col,</span> <span class="pre">...)</span></code>, or with <code class="docutils literal notranslate"><span class="pre">noisy_approx_distinct_sfm()</span></code>.
Generally speaking, <a class="reference internal" href="#noisy_count_gaussian" title="noisy_count_gaussian"><code class="xref py py-func docutils literal notranslate"><span class="pre">noisy_count_gaussian()</span></code></a> returns more accurate results but at a larger computational cost.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="noisy_sum_gaussian">
<span class="sig-name descname"><span class="pre">noisy_sum_gaussian</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_scale</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">random_seed</span></span></em><span class="optional">]</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#noisy_sum_gaussian" title="Link to this definition">¶</a></dt>
<dd><p>Calculates the sum over the input values in <code class="docutils literal notranslate"><span class="pre">col</span></code> and then adds a normally distributed
random double value with 0 mean and standard deviation of <code class="docutils literal notranslate"><span class="pre">noise_scale</span></code>.</p>
<p>If provided, <code class="docutils literal notranslate"><span class="pre">random_seed</span></code> is used to seed the random number generator.
Otherwise, noise is drawn from a secure random.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id5">
<span class="sig-name descname"><span class="pre">noisy_sum_gaussian</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_scale</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lower</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">upper</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">random_seed</span></span></em><span class="optional">]</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#id5" title="Link to this definition">¶</a></dt>
<dd><p>Calculates the sum over the input values in <code class="docutils literal notranslate"><span class="pre">col</span></code> and then adds a normally distributed
random double value with 0 mean and standard deviation of <code class="docutils literal notranslate"><span class="pre">noise_scale</span></code>.
Each value is clipped to the range of [<code class="docutils literal notranslate"><span class="pre">lower</span></code>, <code class="docutils literal notranslate"><span class="pre">upper</span></code>] before adding to the sum.</p>
<p>If provided, <code class="docutils literal notranslate"><span class="pre">random_seed</span></code> is used to seed the random number generator.
Otherwise, noise is drawn from a secure random.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="noisy_avg_gaussian">
<span class="sig-name descname"><span class="pre">noisy_avg_gaussian</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_scale</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">random_seed</span></span></em><span class="optional">]</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#noisy_avg_gaussian" title="Link to this definition">¶</a></dt>
<dd><p>Calculates the average (arithmetic mean) of all the input values in col and then adds a
normally distributed random double value with 0 mean and standard deviation of noise_scale.</p>
<p>If provided, <code class="docutils literal notranslate"><span class="pre">random_seed</span></code> is used to seed the random number generator.
Otherwise, noise is drawn from a secure random.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="id6">
<span class="sig-name descname"><span class="pre">noisy_avg_gaussian</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_scale</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lower</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">upper</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">random_seed</span></span></em><span class="optional">]</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#id6" title="Link to this definition">¶</a></dt>
<dd><p>Calculates the average (arithmetic mean) of all the input values in <code class="docutils literal notranslate"><span class="pre">col</span></code> and then adds a
normally distributed random double value with 0 mean and standard deviation of <code class="docutils literal notranslate"><span class="pre">noise_scale</span></code>.
Each value is clipped to the range of [<code class="docutils literal notranslate"><span class="pre">lower</span></code>, <code class="docutils literal notranslate"><span class="pre">upper</span></code>] before averaging.</p>
<p>If provided, <code class="docutils literal notranslate"><span class="pre">random_seed</span></code> is used to seed the random number generator.
Otherwise, noise is drawn from a secure random.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="noisy_approx_set_sfm">
<span class="sig-name descname"><span class="pre">noisy_approx_set_sfm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsilon</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">buckets</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">precision</span></span></em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">SfmSketch</span></span></span><a class="headerlink" href="#noisy_approx_set_sfm" title="Link to this definition">¶</a></dt>
<dd><p>Returns an SFM sketch of the input values in <code class="docutils literal notranslate"><span class="pre">col</span></code>. This is analogous to the <code class="docutils literal notranslate"><span class="pre">approx_set()</span></code> function,
which returns a (deterministic) HyperLogLog sketch.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">col</span></code> currently supports types: “bigint”, “double”, “string”, “varbinary”.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">epsilon</span></code> (double) is a positive number that controls the level of noise in the sketch, as described in <a class="reference internal" href="#hehir2023" id="id7"><span>[Hehir2023]</span></a>.
Smaller values of epsilon correspond to noisier sketches.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">buckets</span></code> (int) defaults to 4096.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">precision</span></code> (int) defaults to 24.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unlike <code class="docutils literal notranslate"><span class="pre">approx_set()</span></code>, this function returns <code class="docutils literal notranslate"><span class="pre">NULL</span></code> when <code class="docutils literal notranslate"><span class="pre">col</span></code> is empty.
If this behavior is undesirable, use <code class="docutils literal notranslate"><span class="pre">coalesce()</span></code> with <a class="reference internal" href="#noisy_empty_approx_set_sfm" title="noisy_empty_approx_set_sfm"><code class="xref py py-func docutils literal notranslate"><span class="pre">noisy_empty_approx_set_sfm()</span></code></a>.</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="noisy_approx_distinct_sfm">
<span class="sig-name descname"><span class="pre">noisy_approx_distinct_sfm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsilon</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">buckets</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">precision</span></span></em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bigint</span></span></span><a class="headerlink" href="#noisy_approx_distinct_sfm" title="Link to this definition">¶</a></dt>
<dd><p>Equivalent to <code class="docutils literal notranslate"><span class="pre">cardinality(noisy_approx_set_sfm(col,</span> <span class="pre">epsilon,</span> <span class="pre">buckets,</span> <span class="pre">precision))</span></code>,
this returns the approximate cardinality (distinct count) of the column col.
This is analogous to the (deterministic) <a class="reference internal" href="#approx_distinct" title="approx_distinct"><code class="xref py py-func docutils literal notranslate"><span class="pre">approx_distinct()</span></code></a> function.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unlike <a class="reference internal" href="#approx_distinct" title="approx_distinct"><code class="xref py py-func docutils literal notranslate"><span class="pre">approx_distinct()</span></code></a>, this function returns <code class="docutils literal notranslate"><span class="pre">NULL</span></code> when <code class="docutils literal notranslate"><span class="pre">col</span></code> is empty.</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="noisy_empty_approx_set_sfm">
<span class="sig-name descname"><span class="pre">noisy_empty_approx_set_sfm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">epsilon</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">buckets</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">precision</span></span></em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">SfmSketch</span></span></span><a class="headerlink" href="#noisy_empty_approx_set_sfm" title="Link to this definition">¶</a></dt>
<dd><p>Returns an SFM sketch with no items in it. This is analogous to the <code class="docutils literal notranslate"><span class="pre">empty_approx_set()</span></code> function,
which returns an empty (deterministic) <code class="docutils literal notranslate"><span class="pre">HyperLogLog</span></code> sketch.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">epsilon</span></code> (double) is a positive number that controls the level of noise in the sketch, as described in <a class="reference internal" href="#hehir2023" id="id8"><span>[Hehir2023]</span></a>. Smaller values of epsilon correspond to noisier sketches.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">buckets</span></code> (int) defaults to 4096.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">precision</span></code> (int) defaults to 24.</p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="noisy_approx_set_sfm_from_index_and_zeros">
<span class="sig-name descname"><span class="pre">noisy_approx_set_sfm_from_index_and_zeros</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">col_index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">col_zeros</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsilon</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buckets</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">precision</span></span></em><span class="optional">]</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">SfmSketch</span></span></span><a class="headerlink" href="#noisy_approx_set_sfm_from_index_and_zeros" title="Link to this definition">¶</a></dt>
<dd><p>Returns an SFM sketch of the input values in <code class="docutils literal notranslate"><span class="pre">col_index</span></code> and <code class="docutils literal notranslate"><span class="pre">col_zeros</span></code>.</p>
<p>This is similar to <a class="reference internal" href="#noisy_approx_set_sfm" title="noisy_approx_set_sfm"><code class="xref py py-func docutils literal notranslate"><span class="pre">noisy_approx_set_sfm()</span></code></a> except that function calculates a <code class="docutils literal notranslate"><span class="pre">xxhash64()</span></code> of <code class="docutils literal notranslate"><span class="pre">col</span></code>,
and calculates the SFM PCSA bucket index and number of trailing zeros as described in
<a class="reference internal" href="#flajoletmartin1985" id="id9"><span>[FlajoletMartin1985]</span></a>. In this function, the caller must explicitly calculate the hash bucket index
and zeros themselves and pass them as arguments <code class="docutils literal notranslate"><span class="pre">col_index</span></code> and <code class="docutils literal notranslate"><span class="pre">col_zeros</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">col_index</span></code> (bigint) must be in the range <code class="docutils literal notranslate"><span class="pre">0..buckets-1</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">col_zeros</span></code> (bigint) must be in the range <code class="docutils literal notranslate"><span class="pre">0..64</span></code>. If it exceeds <code class="docutils literal notranslate"><span class="pre">precision</span></code>, it
is cropped to <code class="docutils literal notranslate"><span class="pre">precision-1</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">epsilon</span></code> (double) is a positive number that controls the level of noise in
the sketch, as described in <a class="reference internal" href="#hehir2023" id="id10"><span>[Hehir2023]</span></a>. Smaller values of epsilon correspond
to noisier sketches.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">buckets</span></code> (int) is the number of buckets in the SFM PCSA sketch as described in <a class="reference internal" href="#hehir2023" id="id11"><span>[Hehir2023]</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">precision</span></code> (int) defaults to 24.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Like  <a class="reference internal" href="#noisy_approx_set_sfm" title="noisy_approx_set_sfm"><code class="xref py py-func docutils literal notranslate"><span class="pre">noisy_approx_set_sfm()</span></code></a>, this function returns <code class="docutils literal notranslate"><span class="pre">NULL</span></code> when <code class="docutils literal notranslate"><span class="pre">col_index</span></code>
or <code class="docutils literal notranslate"><span class="pre">col_zeros</span></code> is <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.
If this behavior is undesirable, use <code class="xref py py-func docutils literal notranslate"><span class="pre">coalesce()</span></code> with <a class="reference internal" href="#noisy_empty_approx_set_sfm" title="noisy_empty_approx_set_sfm"><code class="xref py py-func docutils literal notranslate"><span class="pre">noisy_empty_approx_set_sfm()</span></code></a>.</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cardinality">
<span class="sig-name descname"><span class="pre">cardinality</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">SfmSketch</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bigint</span></span></span><a class="headerlink" href="#cardinality" title="Link to this definition">¶</a></dt>
<dd><p>Returns the estimated cardinality (distinct count) of an <code class="docutils literal notranslate"><span class="pre">SfmSketch</span></code> object.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="merge">
<span class="sig-name descname"><span class="pre">merge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">SfmSketch</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">SfmSketch</span></span></span><a class="headerlink" href="#merge" title="Link to this definition">¶</a></dt>
<dd><p>An aggregator function that returns a merged <code class="docutils literal notranslate"><span class="pre">SfmSketch</span></code> of the set union of
individual <code class="docutils literal notranslate"><span class="pre">SfmSketch</span></code> objects, similar to <code class="docutils literal notranslate"><span class="pre">merge(HyperLogLog)</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">year</span><span class="p">,</span> <span class="n">cardinality</span><span class="p">(</span><span class="n">merge</span><span class="p">(</span><span class="n">sketch</span><span class="p">))</span> <span class="n">AS</span> <span class="n">annual_distinct_count</span>
<span class="n">FROM</span> <span class="n">monthly_sketches</span>
<span class="n">GROUP</span> <span class="n">BY</span> <span class="mi">1</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="merge_sfm">
<span class="sig-name descname"><span class="pre">merge_sfm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">ARRAY[SfmSketch,</span> <span class="pre">...]</span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">SfmSketch</span></span></span><a class="headerlink" href="#merge_sfm" title="Link to this definition">¶</a></dt>
<dd><p>A scalar function that returns a merged <code class="docutils literal notranslate"><span class="pre">SfmSketch</span></code> of the set union of an array of <code class="docutils literal notranslate"><span class="pre">SfmSketch</span></code> objects, similar to <code class="docutils literal notranslate"><span class="pre">merge_hll()</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">cardinality</span><span class="p">(</span><span class="n">merge_sfm</span><span class="p">(</span><span class="n">ARRAY</span><span class="p">[</span>
    <span class="n">noisy_approx_set_sfm</span><span class="p">(</span><span class="n">col_1</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span>
    <span class="n">noisy_approx_set_sfm</span><span class="p">(</span><span class="n">col_2</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span>
    <span class="n">noisy_approx_set_sfm</span><span class="p">(</span><span class="n">col_3</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>
<span class="p">]))</span> <span class="n">AS</span> <span class="n">distinct_count_over_3_cols</span>
<span class="n">FROM</span> <span class="n">my_table</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="limitations">
<h3>Limitations<a class="headerlink" href="#limitations" title="Link to this heading">¶</a></h3>
<p>While these functions resemble differential privacy mechanisms, the values returned by these
functions are not differentially private in general. There are several important limitations
to keep in mind if using these functions for privacy-preserving purposes, including:</p>
<ul class="simple">
<li><p>All noisy aggregate functions return <code class="docutils literal notranslate"><span class="pre">NULL</span></code> when aggregating empty sets. This means a <code class="docutils literal notranslate"><span class="pre">NULL</span></code>
return value noiselessly indicates the absence of data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> clauses used in combination with noisy aggregation functions reveal non-noisy
information: the presence or absence of a group noiselessly indicates the presence or
absence of data. See, e.g., <a class="reference internal" href="#wilkins2024" id="id12"><span>[Wilkins2024]</span></a>.</p></li>
<li><p>Functions relying on floating-point noise may be susceptible to inference attacks such as
those identified in <a class="reference internal" href="#mironov2012" id="id13"><span>[Mironov2012]</span></a> and <a class="reference internal" href="#casacuberta2022" id="id14"><span>[Casacuberta2022]</span></a>.</p></li>
</ul>
</section>
<section id="references">
<h3>References<a class="headerlink" href="#references" title="Link to this heading">¶</a></h3>
<div role="list" class="citation-list">
<div class="citation" id="casacuberta2022" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id14">Casacuberta2022</a><span class="fn-bracket">]</span></span>
<p>Casacuberta, S., Shoemate, M., Vadhan, S., &amp; Wagaman, C. (2022).
<a class="reference external" href="https://arxiv.org/pdf/2207.10635">Widespread Underestimation of Sensitivity in Differentially Private Libraries and How to Fix It</a>.
In Proceedings of the 2022 ACM SIGSAC Conference on Computer and Communications Security (pp. 471-484).</p>
</div>
<div class="citation" id="hehir2023" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span>Hehir2023<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id7">1</a>,<a role="doc-backlink" href="#id8">2</a>,<a role="doc-backlink" href="#id10">3</a>,<a role="doc-backlink" href="#id11">4</a>)</span>
<p>Hehir, J., Ting, D., &amp; Cormode, G. (2023).
<a class="reference external" href="https://proceedings.mlr.press/v202/hehir23a/hehir23a.pdf">Sketch-Flip-Merge: Mergeable Sketches for Private Distinct Counting</a>.
In Proceedings of the 40th International Conference on Machine Learning (Vol. 202).</p>
</div>
<div class="citation" id="mironov2012" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id13">Mironov2012</a><span class="fn-bracket">]</span></span>
<p>Mironov, I. (2012).
<a class="reference external" href="https://www.microsoft.com/en-us/research/wp-content/uploads/2012/10/lsbs.pdf">On significance of the least significant bits for differential privacy</a>.
In Proceedings of the 2012 ACM Conference on Computer and Communications Security (pp. 650-661).</p>
</div>
<div class="citation" id="wilkins2024" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id12">Wilkins2024</a><span class="fn-bracket">]</span></span>
<p>Wilkins, A., Kifer, D., Zhang, D., &amp; Karrer, B. (2024).
<a class="reference external" href="https://journalprivacyconfidentiality.org/index.php/jpc/article/view/823/755">Exact Privacy Analysis of the Gaussian Sparse Histogram Mechanism</a>.
Journal of Privacy and Confidentiality, 14 (1).</p>
</div>
<div class="citation" id="flajoletmartin1985" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id9">FlajoletMartin1985</a><span class="fn-bracket">]</span></span>
<p>Flajolet, P, Martin, G. N. (1985).
<a class="reference external" href="https://algo.inria.fr/flajolet/Publications/src/FlMa85.pdf">Probabilistic Counting Algorithms for Data Base Applications</a>.
In Journal of Computer and System Sciences, 31:182-209, 1985</p>
</div>
</div>
</section>
</section>
<section id="miscellaneous">
<h2>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="max_data_size_for_stats">
<span class="sig-name descname"><span class="pre">max_data_size_for_stats</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bigint</span></span></span><a class="headerlink" href="#max_data_size_for_stats" title="Link to this definition">¶</a></dt>
<dd><p>Returns an estimate of the the maximum in-memory size in bytes of <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sum_data_size_for_stats">
<span class="sig-name descname"><span class="pre">sum_data_size_for_stats</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bigint</span></span></span><a class="headerlink" href="#sum_data_size_for_stats" title="Link to this definition">¶</a></dt>
<dd><p>Returns an estimate of the sum of in-memory size in bytes of <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p>
</dd></dl>

</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Aggregate Functions</a><ul>
<li><a class="reference internal" href="#general-aggregate-functions">General Aggregate Functions</a><ul>
<li><a class="reference internal" href="#arbitrary"><code class="docutils literal notranslate"><span class="pre">arbitrary()</span></code></a></li>
<li><a class="reference internal" href="#any_value"><code class="docutils literal notranslate"><span class="pre">any_value()</span></code></a></li>
<li><a class="reference internal" href="#array_agg"><code class="docutils literal notranslate"><span class="pre">array_agg()</span></code></a></li>
<li><a class="reference internal" href="#avg"><code class="docutils literal notranslate"><span class="pre">avg()</span></code></a></li>
<li><a class="reference internal" href="#bool_and"><code class="docutils literal notranslate"><span class="pre">bool_and()</span></code></a></li>
<li><a class="reference internal" href="#bool_or"><code class="docutils literal notranslate"><span class="pre">bool_or()</span></code></a></li>
<li><a class="reference internal" href="#checksum"><code class="docutils literal notranslate"><span class="pre">checksum()</span></code></a></li>
<li><a class="reference internal" href="#count"><code class="docutils literal notranslate"><span class="pre">count()</span></code></a></li>
<li><a class="reference internal" href="#count_if"><code class="docutils literal notranslate"><span class="pre">count_if()</span></code></a></li>
<li><a class="reference internal" href="#entropy"><code class="docutils literal notranslate"><span class="pre">entropy()</span></code></a></li>
<li><a class="reference internal" href="#every"><code class="docutils literal notranslate"><span class="pre">every()</span></code></a></li>
<li><a class="reference internal" href="#histogram"><code class="docutils literal notranslate"><span class="pre">histogram()</span></code></a></li>
<li><a class="reference internal" href="#geometric_mean"><code class="docutils literal notranslate"><span class="pre">geometric_mean()</span></code></a></li>
<li><a class="reference internal" href="#max_by"><code class="docutils literal notranslate"><span class="pre">max_by()</span></code></a></li>
<li><a class="reference internal" href="#min_by"><code class="docutils literal notranslate"><span class="pre">min_by()</span></code></a></li>
<li><a class="reference internal" href="#max"><code class="docutils literal notranslate"><span class="pre">max()</span></code></a></li>
<li><a class="reference internal" href="#min"><code class="docutils literal notranslate"><span class="pre">min()</span></code></a></li>
<li><a class="reference internal" href="#multimap_agg"><code class="docutils literal notranslate"><span class="pre">multimap_agg()</span></code></a></li>
<li><a class="reference internal" href="#reduce_agg"><code class="docutils literal notranslate"><span class="pre">reduce_agg()</span></code></a></li>
<li><a class="reference internal" href="#set_agg"><code class="docutils literal notranslate"><span class="pre">set_agg()</span></code></a></li>
<li><a class="reference internal" href="#set_union"><code class="docutils literal notranslate"><span class="pre">set_union()</span></code></a></li>
<li><a class="reference internal" href="#sum"><code class="docutils literal notranslate"><span class="pre">sum()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#bitwise-aggregate-functions">Bitwise Aggregate Functions</a><ul>
<li><a class="reference internal" href="#bitwise_and_agg"><code class="docutils literal notranslate"><span class="pre">bitwise_and_agg()</span></code></a></li>
<li><a class="reference internal" href="#bitwise_or_agg"><code class="docutils literal notranslate"><span class="pre">bitwise_or_agg()</span></code></a></li>
<li><a class="reference internal" href="#bitwise_xor_agg"><code class="docutils literal notranslate"><span class="pre">bitwise_xor_agg()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#map-aggregate-functions">Map Aggregate Functions</a><ul>
<li><a class="reference internal" href="#map_agg"><code class="docutils literal notranslate"><span class="pre">map_agg()</span></code></a></li>
<li><a class="reference internal" href="#map_union"><code class="docutils literal notranslate"><span class="pre">map_union()</span></code></a></li>
<li><a class="reference internal" href="#map_union_sum"><code class="docutils literal notranslate"><span class="pre">map_union_sum()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#approximate-aggregate-functions">Approximate Aggregate Functions</a><ul>
<li><a class="reference internal" href="#approx_distinct"><code class="docutils literal notranslate"><span class="pre">approx_distinct()</span></code></a></li>
<li><a class="reference internal" href="#approx_most_frequent"><code class="docutils literal notranslate"><span class="pre">approx_most_frequent()</span></code></a></li>
<li><a class="reference internal" href="#approx_percentile"><code class="docutils literal notranslate"><span class="pre">approx_percentile()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#classification-metrics-aggregate-functions">Classification Metrics Aggregate Functions</a><ul>
<li><a class="reference internal" href="#classification_miss_rate"><code class="docutils literal notranslate"><span class="pre">classification_miss_rate()</span></code></a></li>
<li><a class="reference internal" href="#id0"><code class="docutils literal notranslate"><span class="pre">classification_miss_rate()</span></code></a></li>
<li><a class="reference internal" href="#classification_fall_out"><code class="docutils literal notranslate"><span class="pre">classification_fall_out()</span></code></a></li>
<li><a class="reference internal" href="#id2"><code class="docutils literal notranslate"><span class="pre">classification_fall_out()</span></code></a></li>
<li><a class="reference internal" href="#classification_precision"><code class="docutils literal notranslate"><span class="pre">classification_precision()</span></code></a></li>
<li><a class="reference internal" href="#id3"><code class="docutils literal notranslate"><span class="pre">classification_precision()</span></code></a></li>
<li><a class="reference internal" href="#classification_recall"><code class="docutils literal notranslate"><span class="pre">classification_recall()</span></code></a></li>
<li><a class="reference internal" href="#id4"><code class="docutils literal notranslate"><span class="pre">classification_recall()</span></code></a></li>
<li><a class="reference internal" href="#classification_thresholds"><code class="docutils literal notranslate"><span class="pre">classification_thresholds()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#statistical-aggregate-functions">Statistical Aggregate Functions</a><ul>
<li><a class="reference internal" href="#corr"><code class="docutils literal notranslate"><span class="pre">corr()</span></code></a></li>
<li><a class="reference internal" href="#covar_pop"><code class="docutils literal notranslate"><span class="pre">covar_pop()</span></code></a></li>
<li><a class="reference internal" href="#covar_samp"><code class="docutils literal notranslate"><span class="pre">covar_samp()</span></code></a></li>
<li><a class="reference internal" href="#kurtosis"><code class="docutils literal notranslate"><span class="pre">kurtosis()</span></code></a></li>
<li><a class="reference internal" href="#regr_avgx"><code class="docutils literal notranslate"><span class="pre">regr_avgx()</span></code></a></li>
<li><a class="reference internal" href="#regr_avgy"><code class="docutils literal notranslate"><span class="pre">regr_avgy()</span></code></a></li>
<li><a class="reference internal" href="#regr_count"><code class="docutils literal notranslate"><span class="pre">regr_count()</span></code></a></li>
<li><a class="reference internal" href="#regr_intercept"><code class="docutils literal notranslate"><span class="pre">regr_intercept()</span></code></a></li>
<li><a class="reference internal" href="#regr_r2"><code class="docutils literal notranslate"><span class="pre">regr_r2()</span></code></a></li>
<li><a class="reference internal" href="#regr_slope"><code class="docutils literal notranslate"><span class="pre">regr_slope()</span></code></a></li>
<li><a class="reference internal" href="#regr_sxx"><code class="docutils literal notranslate"><span class="pre">regr_sxx()</span></code></a></li>
<li><a class="reference internal" href="#regr_sxy"><code class="docutils literal notranslate"><span class="pre">regr_sxy()</span></code></a></li>
<li><a class="reference internal" href="#regr_syy"><code class="docutils literal notranslate"><span class="pre">regr_syy()</span></code></a></li>
<li><a class="reference internal" href="#skewness"><code class="docutils literal notranslate"><span class="pre">skewness()</span></code></a></li>
<li><a class="reference internal" href="#stddev"><code class="docutils literal notranslate"><span class="pre">stddev()</span></code></a></li>
<li><a class="reference internal" href="#stddev_pop"><code class="docutils literal notranslate"><span class="pre">stddev_pop()</span></code></a></li>
<li><a class="reference internal" href="#stddev_samp"><code class="docutils literal notranslate"><span class="pre">stddev_samp()</span></code></a></li>
<li><a class="reference internal" href="#variance"><code class="docutils literal notranslate"><span class="pre">variance()</span></code></a></li>
<li><a class="reference internal" href="#var_pop"><code class="docutils literal notranslate"><span class="pre">var_pop()</span></code></a></li>
<li><a class="reference internal" href="#var_samp"><code class="docutils literal notranslate"><span class="pre">var_samp()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#noisy-aggregate-functions">Noisy Aggregate Functions</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#counts-sums-and-averages">Counts, Sums, and Averages</a><ul>
<li><a class="reference internal" href="#noisy_count_if_gaussian"><code class="docutils literal notranslate"><span class="pre">noisy_count_if_gaussian()</span></code></a></li>
<li><a class="reference internal" href="#noisy_count_gaussian"><code class="docutils literal notranslate"><span class="pre">noisy_count_gaussian()</span></code></a></li>
<li><a class="reference internal" href="#noisy_sum_gaussian"><code class="docutils literal notranslate"><span class="pre">noisy_sum_gaussian()</span></code></a></li>
<li><a class="reference internal" href="#id5"><code class="docutils literal notranslate"><span class="pre">noisy_sum_gaussian()</span></code></a></li>
<li><a class="reference internal" href="#noisy_avg_gaussian"><code class="docutils literal notranslate"><span class="pre">noisy_avg_gaussian()</span></code></a></li>
<li><a class="reference internal" href="#id6"><code class="docutils literal notranslate"><span class="pre">noisy_avg_gaussian()</span></code></a></li>
<li><a class="reference internal" href="#noisy_approx_set_sfm"><code class="docutils literal notranslate"><span class="pre">noisy_approx_set_sfm()</span></code></a></li>
<li><a class="reference internal" href="#noisy_approx_distinct_sfm"><code class="docutils literal notranslate"><span class="pre">noisy_approx_distinct_sfm()</span></code></a></li>
<li><a class="reference internal" href="#noisy_empty_approx_set_sfm"><code class="docutils literal notranslate"><span class="pre">noisy_empty_approx_set_sfm()</span></code></a></li>
<li><a class="reference internal" href="#noisy_approx_set_sfm_from_index_and_zeros"><code class="docutils literal notranslate"><span class="pre">noisy_approx_set_sfm_from_index_and_zeros()</span></code></a></li>
<li><a class="reference internal" href="#cardinality"><code class="docutils literal notranslate"><span class="pre">cardinality()</span></code></a></li>
<li><a class="reference internal" href="#merge"><code class="docutils literal notranslate"><span class="pre">merge()</span></code></a></li>
<li><a class="reference internal" href="#merge_sfm"><code class="docutils literal notranslate"><span class="pre">merge_sfm()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#limitations">Limitations</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#miscellaneous">Miscellaneous</a><ul>
<li><a class="reference internal" href="#max_data_size_for_stats"><code class="docutils literal notranslate"><span class="pre">max_data_size_for_stats()</span></code></a></li>
<li><a class="reference internal" href="#sum_data_size_for_stats"><code class="docutils literal notranslate"><span class="pre">sum_data_size_for_stats()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="url.html"
                          title="previous chapter">URL Functions</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="window.html"
                          title="next chapter">Window functions</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/functions/presto/aggregate.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="window.html" title="Window functions"
             >next</a> |</li>
        <li class="right" >
          <a href="url.html" title="URL Functions"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Velox  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../functions.html" >Presto Functions</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Aggregate Functions</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright TBD.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    </div>
  </body>
</html>