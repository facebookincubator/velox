<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Runtime Stats &#8212; Velox  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/nature.css?v=0f882399" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Pyvelox Documentation" href="../bindings/python/index.html" />
    <link rel="prev" title="Runtime Metrics" href="metrics.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../bindings/python/index.html" title="Pyvelox Documentation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="metrics.html" title="Runtime Metrics"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Velox  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../monitoring.html" accesskey="U">Monitoring</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Runtime Stats</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="runtime-stats">
<h1>Runtime Stats<a class="headerlink" href="#runtime-stats" title="Link to this heading">¶</a></h1>
<p>Runtime stats are used to collect the per-query velox runtime events for
offline query analysis purpose. The collected stats can provide insights into
the operator level query execution internals, such as how much time a query
operator spent in disk spilling. The collected stats are organized in a
free-form key-value for easy extension. The key is the event name and the
value is defined as RuntimeCounter which is used to store and aggregate a
particular event occurrences during the operator execution. RuntimeCounter has
three types: kNone used to record event count, kNanos used to record event time
in nanoseconds and kBytes used to record memory or storage size in bytes. It
records the count of events, and the min/max/sum of the event values. The stats
are stored in OperatorStats structure. The query system can aggregate the
operator level stats collected from each driver by pipeline and task for
analysis.</p>
<section id="memory-arbitration">
<h2>Memory Arbitration<a class="headerlink" href="#memory-arbitration" title="Link to this heading">¶</a></h2>
<p>These stats are reported by all operators.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 40.0%" />
<col style="width: 20.0%" />
<col style="width: 40.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Stats</p></th>
<th class="head"><p>Unit</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>memoryReclaimCount</p></td>
<td></td>
<td><p>The number of times that the memory arbitration to reclaim memory from
an spillable operator.
This stats only applies for spillable operators.</p></td>
</tr>
<tr class="row-odd"><td><p>memoryReclaimWallNanos</p></td>
<td><p>nanos</p></td>
<td><p>The memory reclaim execution time of an operator during the memory
arbitration. It collects time spent on disk spilling or file write.
This stats only applies for spillable operators.</p></td>
</tr>
<tr class="row-even"><td><p>reclaimedMemoryBytes</p></td>
<td><p>bytes</p></td>
<td><p>The reclaimed memory bytes of an operator during the memory arbitration.
This stats only applies for spillable operators.</p></td>
</tr>
<tr class="row-odd"><td><p>globalArbitrationCount</p></td>
<td></td>
<td><p>The number of times a request for more memory hit the arbitrator’s
capacity limit and initiated a global arbitration attempt where
memory is reclaimed from viable candidates chosen among all running
queries based on a criterion.</p></td>
</tr>
<tr class="row-even"><td><p>localArbitrationCount</p></td>
<td></td>
<td><p>The number of times a request for more memory hit the query memory
limit and initiated a local arbitration attempt where memory is
reclaimed from the requestor itself.</p></td>
</tr>
<tr class="row-odd"><td><p>localArbitrationQueueWallNanos</p></td>
<td></td>
<td><p>The time of an operator waiting in local arbitration queue.</p></td>
</tr>
<tr class="row-even"><td><p>localArbitrationLockWaitWallNanos</p></td>
<td></td>
<td><p>The time of an operator waiting to acquire the local arbitration lock.</p></td>
</tr>
<tr class="row-odd"><td><p>globalArbitrationLockWaitWallNanos</p></td>
<td></td>
<td><p>The time of an operator waiting to acquire the global arbitration lock.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="hashbuild-hashaggregation">
<h2>HashBuild, HashAggregation<a class="headerlink" href="#hashbuild-hashaggregation" title="Link to this heading">¶</a></h2>
<p>These stats are reported only by HashBuild and HashAggregation operators.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 40.0%" />
<col style="width: 20.0%" />
<col style="width: 40.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Stats</p></th>
<th class="head"><p>Unit</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>hashtable.capacity</p></td>
<td></td>
<td><p>Number of slots across all buckets in the hash table.</p></td>
</tr>
<tr class="row-odd"><td><p>hashtable.numRehashes</p></td>
<td></td>
<td><p>Number of rehash() calls.</p></td>
</tr>
<tr class="row-even"><td><p>hashtable.numDistinct</p></td>
<td></td>
<td><p>Number of distinct keys in the hash table.</p></td>
</tr>
<tr class="row-odd"><td><p>hashtable.numTombstones</p></td>
<td></td>
<td><p>Number of tombstone slots in the hash table.</p></td>
</tr>
<tr class="row-even"><td><p>hashtable.buildWallNanos</p></td>
<td><p>nanos</p></td>
<td><p>Time spent on building the hash table from rows collected by all the
hash build operators. This stat is only reported by the HashBuild operator.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="tablescan">
<h2>TableScan<a class="headerlink" href="#tablescan" title="Link to this heading">¶</a></h2>
<p>These stats are reported only by TableScan operator</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 40.0%" />
<col style="width: 20.0%" />
<col style="width: 40.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Stats</p></th>
<th class="head"><p>Unit</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>numRunningScanThreads</p></td>
<td></td>
<td><p>The number of running table scan drivers.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="tablewriter">
<h2>TableWriter<a class="headerlink" href="#tablewriter" title="Link to this heading">¶</a></h2>
<p>These stats are reported only by TableWriter operator</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 40.0%" />
<col style="width: 20.0%" />
<col style="width: 40.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Stats</p></th>
<th class="head"><p>Unit</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>earlyFlushedRawBytes</p></td>
<td><p>bytes</p></td>
<td><p>Number of bytes pre-maturely flushed from file writers because of memory reclaiming.</p></td>
</tr>
<tr class="row-odd"><td><p>rebalanceTriggers</p></td>
<td></td>
<td><p>The number of times that we triggers the rebalance of table partitions
for a non-bucketed partition table.</p></td>
</tr>
<tr class="row-even"><td><p>scaledPartitions</p></td>
<td></td>
<td><p>The number of times that we scale a partition processing for a
non-bucketed partition table.</p></td>
</tr>
<tr class="row-odd"><td><p>scaledWriters</p></td>
<td></td>
<td><p>The number of times that we scale writers for a non-partitioned table.</p></td>
</tr>
<tr class="row-even"><td><p>runningWallNanos</p></td>
<td><p>nanos</p></td>
<td><p>The running wall time of a writer operator since its creation.</p></td>
</tr>
<tr class="row-odd"><td><p>numWrittenFiles</p></td>
<td></td>
<td><p>TThe number of files written by a writer operator</p></td>
</tr>
<tr class="row-even"><td><p>writeIOWallNanos</p></td>
<td><p>nanos</p></td>
<td><p>The file write IO walltime.</p></td>
</tr>
<tr class="row-odd"><td><p>writeRecodeWallNanos</p></td>
<td><p>nanos</p></td>
<td><p>The walltime spend on file write data recoding.</p></td>
</tr>
<tr class="row-even"><td><p>writeCompressionWallNanos</p></td>
<td><p>nanos</p></td>
<td><p>The walltime spent on file write data compression.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="lookupindexjoin">
<h2>LookupIndexJoin<a class="headerlink" href="#lookupindexjoin" title="Link to this heading">¶</a></h2>
<p>These stats are reported only by IndexLookupJoin operator</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 40.0%" />
<col style="width: 20.0%" />
<col style="width: 40.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Stats</p></th>
<th class="head"><p>Unit</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>connectorlookupWallNanos</p></td>
<td><p>nanos</p></td>
<td><p>The end-to-end walltime in nanoseconds that the index connector do the lookup.</p></td>
</tr>
<tr class="row-odd"><td><p>connectorlookupWaitWallNanos</p></td>
<td><p>nanos</p></td>
<td><p>The walltime in nanoseconds that the index connector wait for the lookup from
remote storage.</p></td>
</tr>
<tr class="row-even"><td><p>connectorResultPrepareCpuNanos</p></td>
<td><p>nanos</p></td>
<td><p>The cpu time in nanoseconds that the index connector process response from storages
client for followup processing by index join operator.</p></td>
</tr>
<tr class="row-odd"><td><p>clientlookupWaitWallNanos</p></td>
<td><p>nanos</p></td>
<td><p>The walltime in nanoseconds that the storage client wait for the lookup from remote storage.</p></td>
</tr>
<tr class="row-even"><td><p>clientNumStorageRequests</p></td>
<td><p>nanos</p></td>
<td><p>The number of split requests sent to remote storage for a client lookup request.</p></td>
</tr>
<tr class="row-odd"><td><p>clientRequestProcessCpuNanos</p></td>
<td><p>nanos</p></td>
<td><p>The cpu time in nanoseconds that the storage client process request for remote
storage lookup such as encoding the lookup input data into remotr storage request.</p></td>
</tr>
<tr class="row-even"><td><p>clientResultProcessCpuNanos</p></td>
<td><p>nanos</p></td>
<td><p>The cpu time in nanoseconds that the storage client process response from remote
storage lookup such as decoding the response data into velox vectors.</p></td>
</tr>
<tr class="row-odd"><td><p>clientLookupResultRawSize</p></td>
<td><p>bytes</p></td>
<td><p>The byte size of the raw result received from the remote storage lookup.</p></td>
</tr>
<tr class="row-even"><td><p>clientLookupResultSize</p></td>
<td><p>bytes</p></td>
<td><p>The byte size of the result data in velox vectors that are decoded from the raw data
received from the remote storage lookup.</p></td>
</tr>
<tr class="row-odd"><td><p>clientNumLazyDecodedResultBatches</p></td>
<td></td>
<td><p>The number of lazy decoded result batches returned from the storage client.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="merge">
<h2>Merge<a class="headerlink" href="#merge" title="Link to this heading">¶</a></h2>
<p>These stats are reported only by Merge operator</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 40.0%" />
<col style="width: 20.0%" />
<col style="width: 40.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Stats</p></th>
<th class="head"><p>Unit</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>streamingSourceReadWallNanos</p></td>
<td><p>nanos</p></td>
<td><p>The number of a spillable operators that don’t support spill because of
spill limitation. For instance, a window operator do not support spill
if there is no partitioning.</p></td>
</tr>
<tr class="row-odd"><td><p>spilledSourceReadWallNanos</p></td>
<td><p>nanos</p></td>
<td><p>The running wall time of the merge operator reading from the spilled source to
produce the final output. This only applies when spilling is enabled for local
merge.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="spilling">
<h2>Spilling<a class="headerlink" href="#spilling" title="Link to this heading">¶</a></h2>
<p>These stats are reported by operators that support spilling.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 40.0%" />
<col style="width: 20.0%" />
<col style="width: 40.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Stats</p></th>
<th class="head"><p>Unit</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>spillNotSupported</p></td>
<td><p>nanos</p></td>
<td><p>The number of a spillable operators that don’t support spill because of
spill limitation. For instance, a window operator do not support spill
if there is no partitioning.</p></td>
</tr>
<tr class="row-odd"><td><p>spillFillWallNanos</p></td>
<td><p>nanos</p></td>
<td><p>The time spent on filling rows for spilling.</p></td>
</tr>
<tr class="row-even"><td><p>spillSortWallNanos</p></td>
<td><p>nanos</p></td>
<td><p>The time spent on sorting rows for spilling.</p></td>
</tr>
<tr class="row-odd"><td><p>spillExtractVectorWallNanos</p></td>
<td><p>nanos</p></td>
<td><p>The time spent on extracting Vector from RowContainer for spilling.</p></td>
</tr>
<tr class="row-even"><td><p>spillSerializationWallNanos</p></td>
<td><p>nanos</p></td>
<td><p>The time spent on serializing rows for spilling.</p></td>
</tr>
<tr class="row-odd"><td><p>spillFlushWallNanos</p></td>
<td><p>nanos</p></td>
<td><p>The time spent on copy out serialized rows for disk write. If compression
is enabled, this includes the compression time.</p></td>
</tr>
<tr class="row-even"><td><p>spillWrites</p></td>
<td></td>
<td><p>The number of spill writer flushes, equivalent to number of write calls to
underlying filesystem.</p></td>
</tr>
<tr class="row-odd"><td><p>spillWriteWallNanos</p></td>
<td><p>nanos</p></td>
<td><p>The time spent on writing spilled rows to disk.</p></td>
</tr>
<tr class="row-even"><td><p>spillRuns</p></td>
<td></td>
<td><p>The number of times that spilling runs on an operator.</p></td>
</tr>
<tr class="row-odd"><td><p>exceededMaxSpillLevel</p></td>
<td></td>
<td><p>The number of times that an operator exceeds the max spill limit.</p></td>
</tr>
<tr class="row-even"><td><p>spillReadBytes</p></td>
<td><p>bytes</p></td>
<td><p>The number of bytes read from spilled files.</p></td>
</tr>
<tr class="row-odd"><td><p>spillReads</p></td>
<td></td>
<td><p>The number of spill reader reads, equivalent to the number of read calls to the underlying filesystem.</p></td>
</tr>
<tr class="row-even"><td><p>spillReadWallNanos</p></td>
<td><p>nanos</p></td>
<td><p>The time spent on read data from spilled files.</p></td>
</tr>
<tr class="row-odd"><td><p>spillDeserializationWallNanos</p></td>
<td><p>nanos</p></td>
<td><p>The time spent on deserializing rows read from spilled files.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="shuffle">
<h2>Shuffle<a class="headerlink" href="#shuffle" title="Link to this heading">¶</a></h2>
<p>These stats are reported by shuffle operators.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 40.0%" />
<col style="width: 20.0%" />
<col style="width: 40.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Stats</p></th>
<th class="head"><p>Unit</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>shuffleSerdeKind</p></td>
<td></td>
<td><p>Indicates the vector serde kind used by an operator for shuffle with 1
for Presto, 2 for CompactRow, 3 for UnsafeRow. It is reported by Exchange,
MergeExchange and PartitionedOutput operators for now.</p></td>
</tr>
<tr class="row-odd"><td><p>shuffleCompressionKind</p></td>
<td></td>
<td><p>Indicates the compression kind used by an operator for shuffle. The
reported value is set to the corresponding CompressionKind enum with 0
(CompressionKind_NONE) as no compression.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="prefixsort">
<h2>PrefixSort<a class="headerlink" href="#prefixsort" title="Link to this heading">¶</a></h2>
<p>These stats are reported by prefix sort.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 40.0%" />
<col style="width: 20.0%" />
<col style="width: 40.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Stats</p></th>
<th class="head"><p>Unit</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>numPrefixSortKeys</p></td>
<td></td>
<td><p>The number of columns sorted using prefix sort.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="iterativevectorserializer">
<h2>IterativeVectorSerializer<a class="headerlink" href="#iterativevectorserializer" title="Link to this heading">¶</a></h2>
<p>These stats are reported by IterativeVectorSerializer.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 40.0%" />
<col style="width: 20.0%" />
<col style="width: 40.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Stats</p></th>
<th class="head"><p>Unit</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>compressionInputBytes</p></td>
<td></td>
<td><p>The number of bytes before compression.</p></td>
</tr>
<tr class="row-odd"><td><p>compressedBytes</p></td>
<td></td>
<td><p>The number of bytes after compression.</p></td>
</tr>
<tr class="row-even"><td><p>compressionSkippedBytes</p></td>
<td></td>
<td><p>The number of bytes that skip in-efficient compression.</p></td>
</tr>
</tbody>
</table>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Runtime Stats</a><ul>
<li><a class="reference internal" href="#memory-arbitration">Memory Arbitration</a></li>
<li><a class="reference internal" href="#hashbuild-hashaggregation">HashBuild, HashAggregation</a></li>
<li><a class="reference internal" href="#tablescan">TableScan</a></li>
<li><a class="reference internal" href="#tablewriter">TableWriter</a></li>
<li><a class="reference internal" href="#lookupindexjoin">LookupIndexJoin</a></li>
<li><a class="reference internal" href="#merge">Merge</a></li>
<li><a class="reference internal" href="#spilling">Spilling</a></li>
<li><a class="reference internal" href="#shuffle">Shuffle</a></li>
<li><a class="reference internal" href="#prefixsort">PrefixSort</a></li>
<li><a class="reference internal" href="#iterativevectorserializer">IterativeVectorSerializer</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="metrics.html"
                          title="previous chapter">Runtime Metrics</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../bindings/python/index.html"
                          title="next chapter">Pyvelox Documentation</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/monitoring/stats.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../bindings/python/index.html" title="Pyvelox Documentation"
             >next</a> |</li>
        <li class="right" >
          <a href="metrics.html" title="Runtime Metrics"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Velox  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../monitoring.html" >Monitoring</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Runtime Stats</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright TBD.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    </div>
  </body>
</html>