<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Cache Fuzzer &#8212; Velox  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/nature.css?v=0f882399" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Expression Fuzzer" href="expression-fuzzer.html" />
    <link rel="prev" title="Testing Tools" href="../testing.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="expression-fuzzer.html" title="Expression Fuzzer"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../testing.html" title="Testing Tools"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Velox  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../develop.html" >Developer Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../testing.html" accesskey="U">Testing Tools</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Cache Fuzzer</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="cache-fuzzer">
<h1>Cache Fuzzer<a class="headerlink" href="#cache-fuzzer" title="Link to this heading">¶</a></h1>
<p>Cache fuzzer is designed to test the correctness and the reliability of the
in-memory async data cache and the durable local SSD cache, and their
interactions such as staging from async data cache to SSD cache, and load the
cache miss data from SSD cache into async data cache.</p>
<p>During each iteration, the fuzzer performs the following actions steps by steps:
1. Creating a set of data files on local file system with varying sizes as source data files.
2. Setting up the async data cache with and without SSD using a specific configuration.
3. Performing parallel random reads from the source data files created in step1.</p>
<section id="how-to-run">
<h2>How to run<a class="headerlink" href="#how-to-run" title="Link to this heading">¶</a></h2>
<p>Use velox_cache_fuzzer binary to run cache fuzzer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">velox</span><span class="o">/</span><span class="n">exec</span><span class="o">/</span><span class="n">fuzzer</span><span class="o">/</span><span class="n">velox_cache_fuzzer</span>
</pre></div>
</div>
<p>By default, the fuzzer will go through 10 interations. Use –steps
or –duration-sec flag to run fuzzer for longer. Use –seed to
reproduce fuzzer failures.</p>
<p>Here is a full list of supported command line arguments.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">–-steps</span></code>: How many iterations to run. Each iteration generates and
evaluates one tale writer plan. Default is 10.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">–-duration_sec</span></code>: For how long to run in seconds. If both <code class="docutils literal notranslate"><span class="pre">-–steps</span></code>
and <code class="docutils literal notranslate"><span class="pre">-–duration_sec</span></code> are specified, –duration_sec takes precedence.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">–-seed</span></code>: The seed to generate random expressions and input vectors with.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">–-num_threads</span></code>: Number of read threads.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">–-read_iteration_sec</span></code>: For how long each read thread should run (in seconds).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">–-num_source_files</span></code>: Number of data files to be created.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">–-source_file_bytes</span></code>: Source file size in bytes. When set to -1, a random
value from 32MB to 48MB will be used, inclusively.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">–-memory_cache_bytes</span></code>: Memory cache size in bytes. When set to -1, a
random value from 48 to 64MB will be used, inclusively.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">–-ssd_cache_bytes</span></code>: SSD cache size in bytes. When set to -1, 1 out of
10 times SSD cache will be disabled, while the other times, a random value
from 128MB to 256MB will be used, inclusively.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">–-num_ssd_cache_shards</span></code>: Number of SSD cache shards. When set to -1, a
random value from 1 to 4 will be used, inclusively.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">–-ssd_checkpoint_interval_bytes</span></code>: Checkpoint after every
<code class="docutils literal notranslate"><span class="pre">--ssd_checkpoint_interval_bytes</span></code>/<code class="docutils literal notranslate"><span class="pre">--num_ssd_cache_shards</span></code>, written into
each file. 0 means no checkpointing. When set to -1, 1 out of 4 times
checkpoint will be disabled, while the other times, a random value from 32MB
to 64MB will be used, inclusively. Checkpoint after every written into each
file. 0 means no checkpointing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">–-num_restarts</span></code>: Number of cache restarts in one iteration.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">–-enable_file_faulty_injection</span></code>: Enable fault injection on read and write
operations for cache-related files. When enabled, the file read and write
operations will fail 5 out of 100 times.</p></li>
</ul>
<p>If running from CLion IDE, add <code class="docutils literal notranslate"><span class="pre">--logtostderr=1</span></code> to see the full output.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Cache Fuzzer</a><ul>
<li><a class="reference internal" href="#how-to-run">How to run</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="../testing.html"
                          title="previous chapter">Testing Tools</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="expression-fuzzer.html"
                          title="next chapter">Expression Fuzzer</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/develop/testing/cache-fuzzer.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="expression-fuzzer.html" title="Expression Fuzzer"
             >next</a> |</li>
        <li class="right" >
          <a href="../testing.html" title="Testing Tools"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Velox  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../develop.html" >Developer Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../testing.html" >Testing Tools</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Cache Fuzzer</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright TBD.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    </div>
  </body>
</html>