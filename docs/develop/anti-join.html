<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Anti joins &#8212; Velox  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/nature.css?v=601dbdee" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Plan Nodes and Operators" href="operators.html" />
    <link rel="prev" title="Joins" href="joins.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="operators.html" title="Plan Nodes and Operators"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="joins.html" title="Joins"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Velox  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../develop.html" accesskey="U">Developer Guide</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Anti joins</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="anti-joins">
<h1>Anti joins<a class="headerlink" href="#anti-joins" title="Link to this heading">¶</a></h1>
<p>Anti joins can be used to efficiently implement queries with NOT IN &lt;subquery&gt;
and NOT EXISTS &lt;subquery&gt; clauses. The semantics of these queries are different
in the presence of NULLs in the outer query or subquery. NOT IN semantics are
implemented by the null aware anti join. NOT EXISTS semantics are implemented
by the regular anti join.</p>
<p>Velox provides regular anti join via <code class="docutils literal notranslate"><span class="pre">JoinType::kAnti</span></code> and null-aware anti
join via <code class="docutils literal notranslate"><span class="pre">JoinType::kNullAwareAnti</span></code>.</p>
<p>This article explains the differences in semantics between NOT IN and NOT EXISTS
queries and discusses the implementation of these in the null aware and regular
anti joins.</p>
<p>NOTE: Presto optimizer doesn’t plan NOT IN and NOT EXISTS queries using anti
joins. To compensate, query plan translation in Prestissimo detects a NOT IN
pattern and <a class="reference external" href="https://github.com/prestodb/presto/blob/master/presto-native-execution/presto_cpp/main/types/PrestoToVeloxQueryPlan.cpp#L1031">converts</a>
it into Velox anti join plan node.</p>
<p>NOTE: <a class="reference external" href="https://substrait.io/relations/logical_relations/#join-types">Substrait</a>
currently defines only one type of anti join and doesn’t specify
whether the semantics are NOT IN or NOT EXISTS. This topic is in active
<a class="reference external" href="https://github.com/substrait-io/substrait/issues/325">discussion</a>.</p>
<p>It is easiest to understand the semantic differences using examples.</p>
<p>Consider table t:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>id</p></th>
<th class="head"><p>value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>NULL</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>2</p></td>
</tr>
</tbody>
</table>
<p>and table u:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>id</p></th>
<th class="head"><p>value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>NULL</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>3</p></td>
</tr>
</tbody>
</table>
<p>When experimenting with queries, it is convenient to use WITH clause combined
with UNNEST clause to create temporary datasets. Here is how to create and use
the datasets above:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">WITH</span>
<span class="w">     </span><span class="n">t</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="nb">array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)),</span>
<span class="w">     </span><span class="n">u</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="nb">array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">])</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">))</span>
<span class="o">&lt;</span><span class="n">query</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">uses</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">u</span><span class="o">&gt;</span>

<span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="nb">array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>

<span class="w">  </span><span class="n">id</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">value</span>
<span class="c1">------+-------</span>
<span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span>
<span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span>
<span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">2</span>
<span class="p">(</span><span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>

<span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="nb">array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">])</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>

<span class="w">  </span><span class="n">id</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">value</span>
<span class="c1">------+-------</span>
<span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span>
<span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">2</span>
<span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">3</span>
<span class="p">(</span><span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>

<span class="o">&gt;</span><span class="w"> </span><span class="k">WITH</span>
<span class="w">     </span><span class="n">t</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="nb">array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)),</span>
<span class="w">     </span><span class="n">u</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="nb">array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">))</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">FULL</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>

<span class="w">  </span><span class="n">id</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="n">id</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">value</span>
<span class="c1">------+-------+------+-------</span>
<span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">NULL</span>
<span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span>
<span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">NULL</span><span class="w">  </span><span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">2</span>
<span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">NULL</span>
<span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">NULL</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span>
<span class="p">(</span><span class="mi">5</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>
</pre></div>
</div>
<section id="not-in-subquery-semantics">
<h2>NOT IN &lt;subquery&gt; Semantics<a class="headerlink" href="#not-in-subquery-semantics" title="Link to this heading">¶</a></h2>
<p>We need to consider 3 cases of NOT IN queries:</p>
<ul class="simple">
<li><p>Subquery returns a row with a NULL.</p></li>
<li><p>Subquery returns no rows.</p></li>
<li><p>Subquery returns one or more rows and no row has a NULL.</p></li>
</ul>
<section id="not-in-with-nulls-in-the-subquery">
<h3>NOT IN with NULLs in the subquery<a class="headerlink" href="#not-in-with-nulls-in-the-subquery" title="Link to this heading">¶</a></h3>
<p>Consider NOT IN query:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="p">)</span>
</pre></div>
</div>
<p>This query returns an empty result.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="w"> </span><span class="k">WITH</span>
<span class="w">     </span><span class="n">t</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="nb">array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)),</span>
<span class="w">     </span><span class="n">u</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="nb">array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">])</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">))</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="p">);</span>

<span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">value</span>
<span class="c1">----+-------</span>
<span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>
</pre></div>
</div>
<p>This is because the IN LIST contains 3 values: NULL, 2, 3. In SQL, NULL is
considered an unknown value. In this case the IN LIST contains unknown value
and we cannot definitively say whether any given value is in the list or not.
Therefore NOT IN predicate returns a NULL (unknown), hence, the query returns
no result. You can use the following queries to confirm the semantics of the
NOT IN predicate.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>

<span class="w"> </span><span class="n">_col0</span>
<span class="c1">-------</span>
<span class="w"> </span><span class="k">NULL</span>
<span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="p">)</span>

<span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>

<span class="w"> </span><span class="n">_col0</span>
<span class="c1">-------</span>
<span class="w"> </span><span class="k">NULL</span>
<span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="not-in-without-nulls-in-the-subquery">
<h3>NOT IN without NULLs in the subquery<a class="headerlink" href="#not-in-without-nulls-in-the-subquery" title="Link to this heading">¶</a></h3>
<p>Now, consider NOT IN query where subquery doesn’t return NULLs (by removing
NULLs from the u table or adding u.id IS NOT NULL predicate to the subquery).</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This query returns a single row with id 1.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="w"> </span><span class="k">WITH</span>
<span class="w">     </span><span class="n">t</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="nb">array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)),</span>
<span class="w">     </span><span class="n">u</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="nb">array</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">))</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="p">);</span>

<span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">value</span>
<span class="c1">----+-------</span>
<span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span>
<span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case the IN LIST contains 2 values: 2 and 3. NULL NOT IN (2, 3) returns
NULL because we cannot tell definitively whether an unknown value is part of a
set or not, hence, not included in the results. 1 NOT IN (2, 3) returns true,
hence, included in the results. 2 NOT IN (2, 3) returns false, hence, not
included in the results.</p>
</section>
<section id="not-in-with-empty-subquery">
<h3>NOT IN with empty subquery<a class="headerlink" href="#not-in-with-empty-subquery" title="Link to this heading">¶</a></h3>
<p>Now, consider a NOT IN query with a subquery that returns empty results
(by removing all rows from the u table or adding an always false predicate to
the subquery).</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This query returns all rows from t, including the row with NULL id.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="w"> </span><span class="k">WITH</span>
<span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="nb">array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)),</span>
<span class="w">    </span><span class="n">u</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[],</span><span class="w"> </span><span class="nb">array</span><span class="p">[])</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">))</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="p">);</span>

<span class="w">      </span><span class="n">id</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">value</span>
<span class="w">    </span><span class="c1">------+-------</span>
<span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span>
<span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">2</span>
<span class="w">     </span><span class="k">NULL</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span>
<span class="w">    </span><span class="p">(</span><span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, the IN LIST is empty. Hence, all values, including unknown value
(NULL), can be determined to be not part of that set.</p>
</section>
</section>
<section id="not-exists-subquery-semantics">
<h2>NOT EXISTS &lt;subquery&gt; Semantics<a class="headerlink" href="#not-exists-subquery-semantics" title="Link to this heading">¶</a></h2>
<p>Similar to NOT IN queries, we consider 3 cases:</p>
<ul class="simple">
<li><p>Subquery returns a row with a NULL.</p></li>
<li><p>Subquery returns no rows.</p></li>
<li><p>Subquery returns one or more rows and no row has a NULL.</p></li>
</ul>
<section id="not-exists-with-nulls-in-the-subquery">
<h3>NOT EXISTS with NULLs in the subquery<a class="headerlink" href="#not-exists-with-nulls-in-the-subquery" title="Link to this heading">¶</a></h3>
<p>Consider NOT EXISTS query:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
</pre></div>
</div>
<p>This query returns 2 rows with IDs NULL and 1.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="w"> </span><span class="k">WITH</span>
<span class="w">     </span><span class="n">t</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="nb">array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)),</span>
<span class="w">     </span><span class="n">u</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="nb">array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">))</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">id</span><span class="p">);</span>

<span class="w">  </span><span class="n">id</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">value</span>
<span class="c1">------+-------</span>
<span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span>
<span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span>
<span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, we have a correlated subquery, e.g. subquery that includes columns from
the outer query. This subquery returns different results for different outer
query rows.</p>
<p>For the row with id NULL, the sub-query is</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">NULL</span>
</pre></div>
</div>
<p>u.id = NULL predicate always returns NULL, hence, the subquery returns an empty
result, hence, NOT EXISTS &lt;subquery&gt; clause evaluates to true.</p>
<p>For the row with id 1, the sub-query is</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
</pre></div>
</div>
<p>u.id = 1 evaluates to NULL when u.id is null and false when u.id is 2 or 3.
Hence, the subquery results are empty, hence, NOT EXISTS &lt;subquery&gt; clause
evaluate to true.</p>
<p>For the row with id 2, the sub-query is</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
</pre></div>
</div>
<p>u.id = 2 predicate evaluates to true for the row where u.id is 2, hence, the
subquery results are not empty, hence, the NOT EXISTS &lt;subquery&gt; clause
evaluates to false.</p>
</section>
<section id="not-exists-without-nulls-in-the-subquery">
<h3>NOT EXISTS without NULLs in the subquery<a class="headerlink" href="#not-exists-without-nulls-in-the-subquery" title="Link to this heading">¶</a></h3>
<p>Now, consider NOT EXISTS query with no nulls in the subquery:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This query returns 2 rows with IDs NULL and 1. In fact, the presence of NULLs in
the subquery doesn’t affect the results of the NOT EXISTS clause. This is
because u.id = t.id predicate evaluates to NULL when u.id is NULL, hence, rows
with NULLs are excluded from the subquery. Unlike the NOT IN query, NOT EXISTS
query is not sensitive for NULLs in the subquery.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="w"> </span><span class="k">WITH</span>
<span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="nb">array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)),</span>
<span class="w">    </span><span class="n">u</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="nb">array</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">))</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">id</span><span class="p">);</span>

<span class="w">      </span><span class="n">id</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">value</span>
<span class="w">    </span><span class="c1">------+-------</span>
<span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span>
<span class="w">     </span><span class="k">NULL</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span>
<span class="w">    </span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="not-exists-with-empty-subquery">
<h3>NOT EXISTS with empty subquery<a class="headerlink" href="#not-exists-with-empty-subquery" title="Link to this heading">¶</a></h3>
<p>Now, consider a NOT EXISTS query with a subquery that returns empty results.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This query returns all rows from t because subquery always returns an empty
result set. When subquery is empty, the results of NOT IN and NOT EXISTS
queries are the same.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="w"> </span><span class="k">WITH</span>
<span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="nb">array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)),</span>
<span class="w">    </span><span class="n">u</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[],</span><span class="w"> </span><span class="nb">array</span><span class="p">[])</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">))</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">id</span><span class="p">);</span>

<span class="w">      </span><span class="n">id</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">value</span>
<span class="w">    </span><span class="c1">------+-------</span>
<span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">2</span>
<span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span>
<span class="w">     </span><span class="k">NULL</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span>
<span class="w">    </span><span class="p">(</span><span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Link to this heading">¶</a></h2>
<p>NOT IN and NOT EXISTS queries can be implemented efficiently using anti joins.
NOT IN queries are implemented using NULL AWARE ANTI JOIN. NOT EXISTS queries
are implemented using regular ANTI JOIN.</p>
<section id="null-aware-anti-join">
<h3>NULL AWARE ANTI JOIN<a class="headerlink" href="#null-aware-anti-join" title="Link to this heading">¶</a></h3>
<p>NULL AWARE ANTI JOIN is used to implement NOT IN queries.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="p">)</span>
</pre></div>
</div>
<p>The rows from table t are placed on the left side of the join. The rows from the
subquery are placed on the right side of the join. The subquery rows are loaded
into a hash table keyed on “id”. If a NULL is encountered when building the
hash table, the join finishes early with no results. If the hash table is
empty (i.e. subquery returns no results), the join returns all the rows from
the left side including rows with NULL join key. If the hash table is not empty
and has no NULLs, the rows from the left side with no NULLs in the join key are
processed in streaming fashion. For each row, the join looks up a match in the
hash table and returns the row only if there is no match. Rows from the left
side with NULL in the join key are not returned.</p>
<p>This algorithm extends trivially to multiple join keys and NOT IN queries that look like this:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">id1</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">id2</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">id1</span><span class="p">,</span><span class="w"> </span><span class="n">id2</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="p">)</span>
</pre></div>
</div>
<p>To summarize, NULL AWARE ANTI JOIN semantics include</p>
<ul class="simple">
<li><p>Return empty results when the right side contains nulls in the join keys.</p></li>
<li><p>Return left-side rows with NULLs in the join key only when the right side is empty.</p></li>
</ul>
<p>In a distributed setup, evaluating the above conditions requires that every node
knows whether the combined right side is empty or not and whether it contains a
row with a null in the join key. This information is available if the query
broadcasts the right side or uses replicate-nulls-and-any partitioning
strategy.</p>
<p>NOTE: Replicate-null-and-any partitioning strategy replicates all rows with
nulls in the partition-by keys to all destinations and also replicates one
arbitrary chosen row with no nulls in the partition-by keys.</p>
</section>
<section id="anti-join">
<h3>ANTI JOIN<a class="headerlink" href="#anti-join" title="Link to this heading">¶</a></h3>
<p>Regular ANTI JOIN is used to implement NOT EXISTS queries.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
</pre></div>
</div>
<p>First, we rewrite the subquery to return the equi-join clause u.id = t.id.</p>
<p>The rows from table t are placed on the left side of the join. The rows from the
modified subquery are placed on the right side of the join. The subquery rows
are loaded into a hash table keyed on “id”. Subquery rows with NULL join keys
are skipped. If the hash table is empty (i.e. subquery returns no results or
all results have NULLs in join keys), the join returns all the rows from the
left side including rows with NULL join key. This logic is the same between
regular ANTI JOIN and NULL AWARE ANTI JOIN. If the hash table is not empty, the
rows from the left side are processed in streaming fashion. All rows with NULL
in the join key are included in the results unconditionally. For each row with
non-NULL join key, the join looks up a match in the hash table and returns the
row only if there is no match.</p>
<p>This algorithm extends trivially to multiple join keys and NOT EXISTS queries
that look like this:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">id1</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">id2</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The differences between regular and null aware anti join can be summarized as</p>
<ul class="simple">
<li><p>Regular join doesn’t automatically return empty results when the right side
has NULLs in the join keys.</p></li>
<li><p>Regular join unconditionally returns left side rows with NULLs in the join
keys.</p></li>
</ul>
</section>
</section>
<section id="anti-joins-with-extra-filter">
<h2>ANTI JOINs with Extra Filter<a class="headerlink" href="#anti-joins-with-extra-filter" title="Link to this heading">¶</a></h2>
<p>NOT IN and NOT EXISTS queries may contain non-equality conditions that use
columns from the outer query in the subqueries. For example,</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">value</span>
<span class="p">)</span>
</pre></div>
</div>
<p>In this case, whether the subquery contains NULL in the join key or not depends
on values of the outer row and therefore can be different for different outer
rows. Hence, a row with a null in the join key on the right side, doesn’t
automatically make the null aware anti join return empty results.</p>
<p>This can be seen in an example.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="w"> </span><span class="k">WITH</span>
<span class="w">     </span><span class="n">t</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="nb">array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)),</span>
<span class="w">     </span><span class="n">u</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="nb">array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">))</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">value</span><span class="p">);</span>

<span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">value</span>
<span class="c1">----+-------</span>
<span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span>
<span class="w">  </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">2</span>
<span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>
</pre></div>
</div>
<p>In this query, subquery for row with NULL id is</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span>
</pre></div>
</div>
<p>This subquery returns rows with ids 2 and 3. Row with NULL id hash value equal
to 0 and doesn’t pass u.value &gt; 0 predicate. NULL NOT IN (2, 3) returns NULL,
hence, NULL row from the left side is not included in the query result.</p>
<p>Subquery for row with id = 1 is</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span>
</pre></div>
</div>
<p>This subquery returns two rows with ids 2 and 3. 1 NOT IN (2, 3) returns true,
hence, row with id 1 is included in the query results.</p>
<p>Subquery for row with id = 2 is</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span>
</pre></div>
</div>
<p>This subquery returns a single row with id 3. 2 NOT IN (3) returns true, hence,
row with id 2 is included in the query results.</p>
<p>Let’s consider a different example where results include the NULL row.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="w"> </span><span class="k">WITH</span>
<span class="w">     </span><span class="n">t</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="nb">array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)),</span>
<span class="w">     </span><span class="n">u</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">array</span><span class="p">[</span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="nb">array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">))</span>
<span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>

<span class="w">  </span><span class="n">id</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">value</span>
<span class="c1">------+-------</span>
<span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span>
<span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span>
<span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>
</pre></div>
</div>
<p>This query returns the row with NULL. The subquery for that row is:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span>
</pre></div>
</div>
<p>The predicate evaluates to false for all rows in u, hence, the IN LIST is empty,
hence NULL NOT IN &lt;subquery&gt; evaluates to true.</p>
<p>These queries are implemented using anti joins with extra filters. In the
examples above, the implementations use null aware anti joins with extra
filters u.value &gt; t.value and u.value * t.value &gt; 0.</p>
<p>The presence of extra filters changes the implementation of anti join.</p>
<section id="null-aware-anti-join-with-filter">
<h3>NULL AWARE ANTI JOIN with Filter<a class="headerlink" href="#null-aware-anti-join-with-filter" title="Link to this heading">¶</a></h3>
<p>In the presence of an extra filter, null aware anti join cannot finish early
upon encountering a null in the join key on the right side. The join must
finish building the hash table and include all rows, even the ones with nulls
in the join key.</p>
<p>When evaluating left-side rows, the join needs to first collect all matches from
the build side and combine these with all the right-side rows with nulls in the
join key, then evaluate the filter on the matches. If the filter comes out
empty, the row is included in the results. Otherwise, the row is not included.</p>
<p>A more detailed description of this logic goes like this.</p>
<ol class="arabic simple">
<li><dl class="simple">
<dt>Collect the matches.</dt><dd><ol class="arabic simple">
<li><p>If the left side row doesn’t have a null in the join key, include all matches from the right side.</p></li>
<li><p>If the left side row has a null in the join key, include all rows from the right side.</p></li>
<li><p>For all left side rows, include all rows from the right side with nulls in the join keys.</p></li>
</ol>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Evaluate the filter on the matches collected in the previous step.</dt><dd><ol class="arabic simple">
<li><p>Include the left-side row in the results only If the filter comes out empty.</p></li>
</ol>
</dd>
</dl>
</li>
</ol>
<p>Step 1.2 requires evaluating the filter on the cross join of left-side rows with
nulls in the join key with all the right-side rows. This implies that in a
distributed setup the right side must be replicated (broadcasted) to all the
nodes evaluating the join, while the left side can be distributed among nodes
using any convenient strategy.</p>
<p>Step 1.3 requires that right-side rows with nulls in the join keys are
replicated (broadcasted) to all the nodes evaluating the join. This is achieved
using replicate-nulls-and-any partitioning strategy.</p>
</section>
<section id="anti-join-with-filter">
<h3>ANTI JOIN with Filter<a class="headerlink" href="#anti-join-with-filter" title="Link to this heading">¶</a></h3>
<p>In the presence of an extra filter, regular anti join can still unconditionally
return left side rows with nulls in the join key. The subquery with an extra
filter still returns an empty result for these rows.</p>
<p>For the left-side row with no nulls in the join key, the join needs to collect
the matches from the right side. If there are no matches, the row is included
in the results. If there are matches, the extra filter needs to be evaluated.
If the filter comes out empty, the row is included in the results.</p>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Anti joins</a><ul>
<li><a class="reference internal" href="#not-in-subquery-semantics">NOT IN &lt;subquery&gt; Semantics</a><ul>
<li><a class="reference internal" href="#not-in-with-nulls-in-the-subquery">NOT IN with NULLs in the subquery</a></li>
<li><a class="reference internal" href="#not-in-without-nulls-in-the-subquery">NOT IN without NULLs in the subquery</a></li>
<li><a class="reference internal" href="#not-in-with-empty-subquery">NOT IN with empty subquery</a></li>
</ul>
</li>
<li><a class="reference internal" href="#not-exists-subquery-semantics">NOT EXISTS &lt;subquery&gt; Semantics</a><ul>
<li><a class="reference internal" href="#not-exists-with-nulls-in-the-subquery">NOT EXISTS with NULLs in the subquery</a></li>
<li><a class="reference internal" href="#not-exists-without-nulls-in-the-subquery">NOT EXISTS without NULLs in the subquery</a></li>
<li><a class="reference internal" href="#not-exists-with-empty-subquery">NOT EXISTS with empty subquery</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation">Implementation</a><ul>
<li><a class="reference internal" href="#null-aware-anti-join">NULL AWARE ANTI JOIN</a></li>
<li><a class="reference internal" href="#anti-join">ANTI JOIN</a></li>
</ul>
</li>
<li><a class="reference internal" href="#anti-joins-with-extra-filter">ANTI JOINs with Extra Filter</a><ul>
<li><a class="reference internal" href="#null-aware-anti-join-with-filter">NULL AWARE ANTI JOIN with Filter</a></li>
<li><a class="reference internal" href="#anti-join-with-filter">ANTI JOIN with Filter</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="joins.html"
                          title="previous chapter">Joins</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="operators.html"
                          title="next chapter">Plan Nodes and Operators</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/develop/anti-join.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="operators.html" title="Plan Nodes and Operators"
             >next</a> |</li>
        <li class="right" >
          <a href="joins.html" title="Joins"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Velox  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../develop.html" >Developer Guide</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Anti joins</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright TBD.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>