# Copyright (c) Facebook, Inc. and its affiliates.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -85,6 +85,12 @@ else()
   set(IS_X86_64_ARCH FALSE)
 endif()
 
+if(NOT DEFINED IS_AARCH64_ARCH AND ${CMAKE_SYSTEM_PROCESSOR} MATCHES "aarch64")
+  set(IS_AARCH64_ARCH TRUE)
+else()
+  set(IS_AARCH64_ARCH FALSE)
+endif()
+
 if(CMAKE_SYSTEM_NAME STREQUAL "Windows")
   # Check target architecture
   if (NOT CMAKE_SIZEOF_VOID_P EQUAL 8)
@@ -372,6 +378,25 @@ if (IS_X86_64_ARCH AND NOT MSVC)
   )
 endif()
 
+set(ARM_AOR_ASM_FILES
+  ${FOLLY_DIR}/external/aor/memcpy-advsimd.S
+  ${FOLLY_DIR}/external/aor/memcpy-armv8.S
+  ${FOLLY_DIR}/external/aor/memcpy_sve.S
+  ${FOLLY_DIR}/external/aor/memset-advsimd.S
+)
+if (IS_AARCH64_ARCH)
+  foreach (AOR_FILE IN LISTS ARM_AOR_ASM_FILES)
+    set_property(
+      SOURCE
+      ${AOR_FILE}
+      APPEND PROPERTY COMPILE_OPTIONS "-x" "assembler-with-cpp"
+    )
+    list(APPEND folly_base_files
+      ${AOR_FILE}
+    )
+  endforeach()
+endif()
+
 add_library(folly_base OBJECT
   ${folly_base_files}
   ${CMAKE_CURRENT_BINARY_DIR}/folly/folly-config.h
